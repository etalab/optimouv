{% extends '::BOLayout.html.twig' %}

{% block pagewrapper %}


    <div id="page-wrapper">

        <div class="row">
            <div class="col-lg-12">
                <h3 class="page-header">Gérer vos rapports </h3>
            </div>
        </div>

        <div class="row">
            <div class="col-lg-12">
                {% set rencontre = ["barycentre", "exclusion", "meilleurLieu", "terrainNeutre"] %}


                {# tableau pour les rapports de meilleurs lieux de rencontre #}

                <div class="panel panel-default">
                    <div class="panel-heading">
                        Liste de vos rapports ~ Meilleurs lieux de rencontres

                     </div>

                    <div class="panel-body">
                        <div class="dataTable_wrapper">
                            <div class="span3">
                                <table class="table table-striped table-hover table-bordered table-fixed"
                                       id="tableRapport">
                                    <thead>
                                    <tr>
                                        <th>No</th>
                                        <th>Nom du rapport</th>
                                        <th>Type du rapport</th>
                                        <th>Date de création</th>
                                        <th>Statut</th>
                                        <th>Action</th>

                                    </tr>
                                    </thead>


                                    <tbody>

                                    {% for infoRapport in infoRapports %}
                                        {% if infoRapport.typeAction in rencontre %}
                                            <tr id="{{ infoRapport.id }}">

                                                <td> {{ infoRapport.id }} </td>
                                                <td> {{ infoRapport.nom }} </td>

                                                {% if infoRapport.typeAction == "allerRetour" %}
                                                    <td> Optimisation de poules - match aller retour</td>
                                                {% elseif infoRapport.typeAction == "allerSimple" %}
                                                    <td> Optimisation de poules - match aller simple</td>
                                                {% elseif infoRapport.typeAction == "plateau" %}
                                                    <td> Optimisation de poules - plateau</td>
                                                {% elseif infoRapport.typeAction == "barycentre" %}
                                                    <td> Meilleur lieu - barycentre</td>
                                                {% elseif infoRapport.typeAction == "meilleurLieu" %}
                                                    <td> Meilleur lieu - lieux définis</td>
                                                {% elseif infoRapport.typeAction == "exclusion" %}
                                                    <td> Meilleur lieu - barycentre avec exclusion</td>
                                                {% elseif infoRapport.typeAction == "terrainNeutre" %}
                                                    <td> Meilleur lieu - lieux définis avec liste de lieux</td>
                                                {% else %}
                                                    <td> {{ infoRapport.typeAction }} </td>
                                                {% endif %}


                                                <td> {{ infoRapport.dateCreation.date|date('d/m/Y') }} </td>

                                                {% if infoRapport.statut  == -1 %}
                                                    <td> Erreur</td>
                                                {% elseif infoRapport.statut  == 0 %}
                                                    <td> En attente</td>
                                                {% elseif infoRapport.statut == 1 %}
                                                    <td> En cours</td>
                                                {% elseif infoRapport.statut  == 2 %}
                                                    <td> Succès</td>
                                                {% else %}
                                                    <td> Inconnu</td>
                                                {% endif %}


                                                <td>
                                                    {% if infoRapport.statut  == 2 %}

                                                        <form name="consulterRapport"
                                                              action="{{ path('ffbb_consulter_rapport', {'idRapport':infoRapport.id, 'typeAction': infoRapport.typeAction}) }}"
                                                              method="post">
                                                            <input type="hidden" name="typeAction" id="typeAction"
                                                                   value="{{ infoRapport.typeAction }}">
                                                            <button type="submit" class="btn btn-consulter-rapport">
                                                                Visualiser
                                                            </button>
                                                            <a href="{{ path('ffbb_editer_rapport', {idRapport: infoRapport.id}) }}"
                                                               class="btn btn-ajouter-reparition">Renommer</a>
                                                            <button type="button" name="delete"
                                                                    class="btn btn-ajouter-reparition"
                                                                    onclick="deleteRapport({{ infoRapport.id }})">
                                                                Supprimer
                                                            </button>


                                                        </form>
                                                    {% else %}
                                                        <button type="submit" class="btn btn-consulter-rapport"
                                                                disabled>Consulter
                                                        </button>


                                                    {% endif %}

                                                </td>


                                            </tr>
                                        {% endif %}

                                    {% endfor %}


                                    </tbody>

                                </table>
                            </div>
                        </div>
                        <!-- /.table-responsive -->
                    </div>

                </div>

                {# tableau pour les rapports de poules #}

                <div class="panel panel-default">
                    <div class="panel-heading">
                        Liste de vos rapports ~ Optimisation des poules

                    </div>

                    <div class="panel-body">
                        <div class="dataTable_wrapper">
                            <div class="span3">
                                <table class="table table-striped table-hover table-bordered table-fixed"
                                       id="tableRapportPoule">
                                    <thead>
                                    <tr>
                                        <th>No</th>
                                        <th>Nom du rapport</th>
                                        <th>Type du rapport</th>
                                        <th>Date de création</th>
                                        <th>Statut</th>
                                        <th>Action</th>

                                    </tr>
                                    </thead>


                                    <tbody>

                                    {% for infoRapport in infoRapports %}
                                        {% if infoRapport.typeAction not in rencontre %}
                                            <tr id="{{ infoRapport.id }}">

                                                <td> {{ infoRapport.id }} </td>
                                                <td> {{ infoRapport.nom }} </td>

                                                {% if infoRapport.typeAction == "allerRetour" %}
                                                    <td> Optimisation de poules - match aller retour</td>
                                                {% elseif infoRapport.typeAction == "allerSimple" %}
                                                    <td> Optimisation de poules - match aller simple</td>
                                                {% elseif infoRapport.typeAction == "plateau" %}
                                                    <td> Optimisation de poules - plateau</td>
                                                {% elseif infoRapport.typeAction == "barycentre" %}
                                                    <td> Meilleur lieu - barycentre</td>
                                                {% elseif infoRapport.typeAction == "meilleurLieu" %}
                                                    <td> Meilleur lieu - lieux définis</td>
                                                {% elseif infoRapport.typeAction == "exclusion" %}
                                                    <td> Meilleur lieu - barycentre avec exclusion</td>
                                                {% elseif infoRapport.typeAction == "terrainNeutre" %}
                                                    <td> Meilleur lieu - lieux définis avec liste de lieux</td>
                                                {% else %}
                                                    <td> {{ infoRapport.typeAction }} </td>
                                                {% endif %}


                                                <td> {{ infoRapport.dateCreation.date|date('d/m/Y') }} </td>

                                                {% if infoRapport.statut  == -1 %}
                                                    <td> Erreur</td>
                                                {% elseif infoRapport.statut  == 0 %}
                                                    <td> En attente</td>
                                                {% elseif infoRapport.statut == 1 %}
                                                    <td> En cours</td>
                                                {% elseif infoRapport.statut  == 2 %}
                                                    <td> Succès</td>
                                                {% else %}
                                                    <td> Inconnu</td>
                                                {% endif %}


                                                <td>
                                                    {% if infoRapport.statut  == 2 %}

                                                        <form name="consulterRapport"
                                                              action="{{ path('ffbb_consulter_rapport', {'idRapport':infoRapport.id, 'typeAction': infoRapport.typeAction}) }}"
                                                              method="post">
                                                            <input type="hidden" name="typeAction" id="typeAction"
                                                                   value="{{ infoRapport.typeAction }}">
                                                            <button type="submit" class="btn btn-consulter-rapport">
                                                                Visualiser
                                                            </button>
                                                            <a href="{{ path('ffbb_editer_rapport', {idRapport: infoRapport.id}) }}"
                                                               class="btn btn-ajouter-reparition">Renommer</a>
                                                            <button type="button" name="delete"
                                                                    class="btn btn-ajouter-reparition"
                                                                    onclick="deleteRapport({{ infoRapport.id }})">
                                                                Supprimer
                                                            </button>


                                                        </form>
                                                    {% else %}
                                                        <button type="submit" class="btn btn-consulter-rapport"
                                                                disabled>Consulter
                                                        </button>


                                                    {% endif %}

                                                </td>


                                            </tr>
                                        {% endif %}

                                    {% endfor %}


                                    </tbody>

                                </table>
                            </div>
                        </div>
                        <!-- /.table-responsive -->
                    </div>

                </div>



            </div>
        </div>


    </div>

{% endblock %}

{% block javascripts %}
    {{ parent() }}

    <script>
        $(document).ready(function () {
            $('#tableRapport').DataTable({
                responsive: true,
                "order": [[ 0, "desc" ]]
            });

        });

        $(document).ready(function () {
            $('#tableRapportPoule').DataTable({
                responsive: true,
                "order": [[ 0, "desc" ]]
            });

        });


        function deleteRapport(idRapport){
            $.ajax({
                url: '/admin/rapport/delete/' +idRapport,
                type: 'GET',
                data: null,
                contentType: false,
                dataType : "json",
                processData: false,
                success: function(data, textStatus, jqXHR)
                {
                    console.log(data);
                    if(typeof data.success)
                    {
                        deletedRapportDiv = '#' + idRapport;

                        $(deletedRapportDiv).remove();


                    }
                    else
                    {
                        // Handle errors here

                    }
                },
                error: function(jqXHR, textStatus, errorThrown)
                {
                    // Handle errors here

                }
            });
        }
    </script>
{% endblock %}



