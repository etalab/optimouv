<!-- Logo -->
{% set kernelRootDir = kernelRootDir[:-3] %}

{% if typeInclude == "export" %}
    <img src="{{ kernelRootDir }}web\bundles\ffbb\accueil\img\Logo-Optimouv.jpg">

{% elseif typeInclude == "previsualisation" %}
    <img src="{{ asset('bundles/ffbb/accueil/img/Logo-Optimouv.jpg') }}" >

{% endif %}




<!-- declaration de variables -->
<!-- distanceMin -->
{% set distanceMinOp = scenarioOptimalSansContrainte.estimationGenerale.distanceTotale %}
{% set distanceMinOp = (distanceMinOp / 1000)|round %}
<!-- distanceTotale -->
{% set distanceTotaleOp = scenarioOptimalSansContrainte.estimationGenerale.distanceTotaleTousParticipants %}
{% set distanceTotaleOp = (distanceTotaleOp / 1000)|round %}
<!-- nbrParticipantsTotal -->
{% set nbrParticipantsTotalOp = scenarioOptimalSansContrainte.estimationGenerale.nbrParticipantsTotal %}
<!-- dureeTotale -->
{% set dureeTotaleOp = scenarioOptimalSansContrainte.estimationGenerale.dureeTotale %}
<!-- estimationDetails -->
{% set estimationDetailsOp = scenarioOptimalSansContrainte.estimationDetails %}
<!-- rencontreDetails -->
{% set rencontreDetailsOp = scenarioOptimalSansContrainte.rencontreDetails %}
<!-- coordPoules -->
{% set coordPoulesOp = scenarioOptimalSansContrainte.poulesCoords %}


<br><br>

<h3> Export de votre recherche "{{ nomRapport }}" - scénario optimal sans contrainte</h3>
<h4>Fédération : UFOLEP</h4>
<h4> Discipline : Rugby</h4>
<h4>Utilisateur : {{ nomUtilisateur }} </h4>
<h4>Nom de la liste : {{ nomListe }}</h4>
<h4>Nom du groupe : {{ nomGroupe }}</h4>

{% if typeMatch == "allerRetour" %}
<h4>  Type de rencontre : Optimisation de poules - match aller retour </h4>
{% elseif typeMatch == "allerSimple" %}
<h4>  Type de rencontre : Optimisation de poules - match aller simple </h4>
{% elseif typeMatch == "plateau" %}
<h4>  Type de rencontre : Optimisation de poules - match aller plateau </h4>
{% else %}
<h4> Type de rencontre : {{ typeMatch }} </h4>
{% endif %}

<h4>Poules : {{ nombrePoule }} poules de {{ taillePoule }} équipes </h4>
{% if contraintsExiste == 1 %}
{% set contrainte = "Avec contrainte" %}

{% else %}
{% set contrainte = "Sans contrainte" %}

{% endif %}
<h4>Contraintes : {{ contrainte }} </h4>


{% set couleur = ['080830', 'd00c05', 'f1c62a', '0d5c35', 'd400ff', '5eb6dd', '8fcf3c', 'ff5900', 'ff73bf', '52251c', '0a1574', 'ff9300', '6b1a6a', '41ab7b','c2314e', '444459', 'b99654', 'a44906', '023548', 'b2b2b2', '616600', '790000', '147376', 'd4cd4a', '95b37c', '006d80' ] %}
{% for key,coordPouleOpSansContrainte in coordPoulesOp %}
{% set coordEq ="" %}
{% for coordonneeVilleOpSansContrainte in coordPouleOpSansContrainte %}
{% set  x = coordonneeVilleOpSansContrainte[0] %}
{% set y =  coordonneeVilleOpSansContrainte[1] %}
{% set xy = x~"%2C"~y %}
{% set coordEq = coordEq~xy~"%2C" %}


{% endfor %}
{% set coordEq = coordEq[:-3] %}
{% set Marker = couleur[key] %}
<img src="https://image.maps.api.here.com/mia/1.6/mapview?poi={{ coordEq }}&ml=fre&poitxs=16&poifc={{ Marker }}&app_id={{ app_id }}&amp;app_code={{ app_code }}&z=6&w=400&h=200" style="margin-left: 40px">
{% endfor %}



<div style="page-break-after:always;"></div>

<!-- bloc estimation générale -->
<div>
    <h4> Estimations</h4>
    <ul>

        <li>
            <strong>{{ distanceMinOp|number_format(0, ',', ' ') }} </strong>
            kilomètres au total
            à parcourir pour l'ensemble du scénario
        </li>
        <li>
            <strong> {{ (distanceTotaleOp * 0.80 )|round|number_format(0, ',', ' ') }}</strong>
            € pour réaliser les trajets de l'ensemble du scénario
            en voiture
        </li>
        <li>
            <strong> {{ (distanceTotaleOp /4 * 0.80 )|round|number_format(0, ',', ' ') }}</strong>
            € pour réaliser les trajets de l'ensemble du scénario
            en covoiturage
        </li>
        <li>
            <strong>{{ (distanceTotaleOp /9 * 1.31)|round|number_format(0, ',', ' ') }} </strong>
            € pour réaliser les trajets de l'ensemble du scénario
            en minibus
        </li>
        <li>
            <strong> {{ (distanceTotaleOp * 0.157)|round|number_format(0, ',', ' ') }}</strong>
            KG eq CO2 d'émissions totales de GES pour {{ nbrParticipantsTotalOp }}
            joueurs en voiture individuelle
            pour le scénario
        </li>
        <li>
            <strong>{{ (distanceTotaleOp/4 * 0.157)|round|number_format(0, ',', ' ') }} </strong>
            KG eq CO2 d'émissions totales de GES pour {{ nbrParticipantsTotalOp }}
            joueurs en co-voiturage pour le scénario
        </li>
        <li>
            <strong>{{ (distanceTotaleOp/9 * 0.185)|round|number_format(0, ',', ' ') }} </strong>
            KG eq CO2 d'émissions totales de GES pour {{ nbrParticipantsTotalOp }}
            joueurs en minibus pour le scénario

        </li>
    </ul>

</div>

<div style="page-break-after:always;"></div>
<hr>
<h4> Détails des estimations </h4>

<!-- bloc détails calcul pour poules -->
<div>
    {% set alphabet = ['A', 'B', 'C', 'D', 'E', 'F', 'G', 'H', 'I', 'J', 'K', 'L', 'M', 'N','O', 'P', 'Q', 'R', 'S', 'T', 'U', 'V', 'W', 'X', 'Y', 'Z' ] %}

    <table>
        <thead>
        <tr>
            <th>
                Participants
            </th>
            <th>Kilomètres à
                parcourir
            </th>
            <th>Temps de parcours
                (J H:M)
            </th>
            <th>Coût du parcours en
                voiture(€)
            </th>
            <th >Coût du parcours en
                covoiturage(€)
            </th>
            <th>Coût du parcours en
                minibus(€)
            </th>
            <th >Emissions GES voiture
                individuelle (en KG eq CO2)
            </th>
            <th>Emissions GES
                covoiturage (en KG eq CO2)
            </th>

            <th>Emissions GES minibus
                (en KG eq CO2)
            </th>
        </tr>
        </thead>
        <tbody>

        {% set dureeTotaleScOpSansContrainteDetail = "" %}
        {% for key, estimationDetailOpSansContrainte in estimationDetailsOp %}
        {% set distanceOpSansContrainteDetail = estimationDetailsOp[ loop.index ].distanceTotale // 1000 %}
        {% set distanceTotaleOpDetail = estimationDetailsOp[ loop.index ].distanceTotaleTousParticipants // 1000 %}
        {% set dureeTotaleOpDetail = estimationDetailsOp[ loop.index ].dureeTotale  %}
        {% set nbrParticipantsOpSansContrainteDetail = estimationDetailsOp[ loop.index ].nbrParticipantsTotal  %}
        {% set lettre = alphabet[key-1] %}

        <tr>
            <td><strong> Poule {{ lettre }} </strong></td>
            <td style="text-align:right"> {{distanceOpSansContrainteDetail|number_format(0, ',', ' ') }}</td>
            <td style="text-align:right">

                <!-- récupérer le nbr de jour -->
                {% set nbrJour = (dureeTotaleOpDetail/86400)|round %}
                {% if nbrJour <10 %}
                {% set nbrJour = "0"~nbrJour %}
                {% endif %}
                <!-- récupérer le nbr d heure -->
                {% set nbrHeure = ((dureeTotaleOpDetail%86400)/3600)|round %}
                {% if nbrHeure <10 %}
                {% set nbrHeure = "0"~nbrHeure %}
                {% endif %}
                <!-- récupérer le nbr de minute -->
                {% set nbrMin = (((dureeTotaleOpDetail%86400)%3600)/60)|round %}
                {% if nbrMin <10 %}
                {% set nbrMin = "0"~nbrMin %}
                {% endif %}
                {{ nbrJour}} {{ nbrHeure }}:{{ nbrMin }}

            </td>
            <td style="text-align:right"> {{ (distanceTotaleOpDetail  * 0.80)|round|number_format(0, ',', ' ') }}</td>
            <td style="text-align:right"> {{ (distanceTotaleOpDetail /4 * 0.80)|round|number_format(0, ',', ' ') }}</td>
            <td style="text-align:right"> {{ (distanceTotaleOpDetail /9 * 1.31)|round|number_format(0, ',', ' ') }}</td>
            <td style="text-align:right"> {{ (distanceTotaleOpDetail * 0.157)|round|number_format(0, ',', ' ') }}</td>
            <td style="text-align:right"> {{ ((distanceTotaleOpDetail /4)*0.157)|round|number_format(0, ',', ' ')  }} </td>
            <td style="text-align:right"> {{ ((distanceTotaleOpDetail/9)*0.185)|round|number_format(0, ',', ' ') }} </td>
        </tr>
        {% set dureeTotaleScOpSansContrainteDetail = dureeTotaleScOpSansContrainteDetail + dureeTotaleOpDetail %}

        {% endfor %}
        <tr>
            <td><strong> Totaux </strong></td>
            <td style="text-align:right"> {{ distanceMinOp|number_format(0, ',', ' ') }}</td>
            <td style="text-align:right">

                <!-- récupérer le nbr de jour -->
                {% set nbrJourTotalScOptContrainte = (dureeTotaleScOpSansContrainteDetail/86400)|round %}
                {% if nbrJourTotalScOptContrainte <10 %}
                {% set nbrJourTotalScOptContrainte = "0"~nbrJourTotalScOptContrainte %}
                {% endif %}
                <!-- récupérer le nbr d heure -->
                {% set nbrHeureTotalScOptContrainte = ((dureeTotaleScOpSansContrainteDetail%86400)/3600)|round %}
                {% if nbrHeureTotalScOptContrainte <10 %}
                {% set nbrHeureTotalScOptContrainte = "0"~nbrHeureTotalScOptContrainte %}
                {% endif %}
                <!-- récupérer le nbr de minute -->
                {% set nbrMinTotalScOptContrainte = (((dureeTotaleScOpSansContrainteDetail%86400)%3600)/60)|round %}
                {% if nbrMinTotalScOptContrainte <10 %}
                {% set nbrMinTotalScOptContrainte = "0"~nbrMinTotalScOptContrainte %}
                {% endif %}
                {{ nbrJourTotalScOptContrainte}} {{ nbrHeureTotalScOptContrainte }}:{{ nbrMinTotalScOptContrainte }}

            </td>
            <td style="text-align:right"> {{ (distanceTotaleOp  * 0.80)|round|number_format(0, ',', ' ') }}</td>
            <td style="text-align:right"> {{ (distanceTotaleOp /4 * 0.80)|round|number_format(0, ',', ' ') }}</td>
            <td style="text-align:right"> {{ (distanceTotaleOp /9 * 1.31)|round|number_format(0, ',', ' ') }}</td>
            <td style="text-align:right"> {{ (distanceTotaleOp * 0.157)|round|number_format(0, ',', ' ') }}</td>
            <td style="text-align:right"> {{ ((distanceTotaleOp /4)*0.157)|round|number_format(0, ',', ' ')  }} </td>
            <td style="text-align:right"> {{ ((distanceTotaleOp/9)*0.185)|round|number_format(0, ',', ' ') }} </td>
        </tr>
        </tbody>
    </table>

</div>

<div style="page-break-after:always;"></div>
<hr>
<h4> Liste des rencontres </h4>

<!-- bloc détails rencontres -->
<div >
    <table>

        <tbody>
        {% for key, rencontreDetailOpSansContrainte in rencontreDetailsOp %}
        {% set distanceOptSansContrainte = rencontreDetailsOp[ loop.index ] %}

        <tr>
            {% set lettre = alphabet[key-1] %}
            <td><strong> Poule {{ lettre }} </strong></td>

            <td>
                <ul>
                    {% for keyDetailOptSansContrainte, detailsOptSansContrainte in distanceOptSansContrainte %}
                    <li>
                        {{ distanceOptSansContrainte[ loop.index ].equipeDepartNom }}
                        ~ {{ distanceOptSansContrainte[ loop.index ].equipeDestinationNom }}
                    </li>

                    {% endfor %}
                </ul>
            </td>

        </tr>

        {% endfor %}
        </tbody>

    </table>
</div>
