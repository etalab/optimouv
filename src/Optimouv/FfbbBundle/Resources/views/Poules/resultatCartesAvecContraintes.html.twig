<!-- .panel-heading -->
<div class="panel-body">

    <!--  Scénarios avec contraintes -->
    <div class="row">

        <!--  Scénario optimal avec contrainte -->
        <div class="col-lg-6">
            <!-- declaration de variables -->
            <!-- distanceMin -->
            {% set distanceMin = scenarioOptimalAvecContrainte.estimationGenerale.distanceTotale %}
            {% set distanceMin = (distanceMin / 1000)|round %}
            <!-- distanceTotale -->
            {% set distanceTotale = scenarioOptimalAvecContrainte.estimationGenerale.distanceTotaleTousParticipants %}
            {% set distanceTotale = (distanceTotale / 1000)|round %}
            <!-- nbrParticipantsTotal -->
            {% set nbrParticipantsTotal = scenarioOptimalAvecContrainte.estimationGenerale.nbrParticipantsTotal %}
            <!-- dureeTotale -->
            {% set dureeTotale = scenarioOptimalAvecContrainte.estimationGenerale.dureeTotale %}
            <!-- estimationDetails -->
            {% set estimationDetailsOptContrainte = scenarioOptimalAvecContrainte.estimationDetails %}
            <!-- rencontreDetails -->
            {% set rencontreDetailsOptContrainte = scenarioOptimalAvecContrainte.rencontreDetails %}
            <!-- coordPoules -->
            {% set coordPoules = scenarioOptimalAvecContrainte.poulesCoords %}


            <div class="panel-body">
                <div class="panel-group" id="accordion">
                    <div class="panel panel-default">
                        <div class="panel-heading">
                            <h4 class="panel-title">
                                Scénario optimal
                            </h4>
                        </div>
                        <div id="collapseOne" class="panel-collapse collapse in">
                            <div class="panel-body"> <!-- premier scÃ©nario -->
                                <div id="map"
                                     style="width: 100%; height: 500px; background: grey"></div>
                                <script type="text/javascript" charset="UTF-8">

                                    /**
                                     *
                                     * Changer la langue de la carte
                                     */
                                    function switchMapLanguage(map, platform) {
                                        var mapTileService = platform.getMapTileService({
                                                    type: 'base'
                                                }),
                                                frenchMapLayer = mapTileService.createTileLayer(
                                                        'maptile',
                                                        'normal.day',
                                                        256,
                                                        'png8',
                                                        {lg: 'fre'}
                                                );
                                        map.setBaseLayer(frenchMapLayer);


                                    }
                                    /*
                                     Fin fn changer langue
                                     */

                                    // Create a marker icon from an image URL:

                                    var icons0 = new H.map.Icon('{{ asset('bundles/ffbb/images/icon0.png') }}');
                                    var icons1 = new H.map.Icon('{{ asset('bundles/ffbb/images/icon1.png') }}');
                                    var icons2 = new H.map.Icon('{{ asset('bundles/ffbb/images/icon2.png') }}');
                                    var icons3 = new H.map.Icon('{{ asset('bundles/ffbb/images/icon3.png') }}');
                                    var icons4 = new H.map.Icon('{{ asset('bundles/ffbb/images/icon4.png') }}');
                                    var icons5 = new H.map.Icon('{{ asset('bundles/ffbb/images/icon5.png') }}');
                                    var icons6 = new H.map.Icon('{{ asset('bundles/ffbb/images/icon6.png') }}');
                                    var icons7 = new H.map.Icon('{{ asset('bundles/ffbb/images/icon7.png') }}');
                                    var icons8 = new H.map.Icon('{{ asset('bundles/ffbb/images/icon8.png') }}');
                                    var icons9 = new H.map.Icon('{{ asset('bundles/ffbb/images/icon9.png') }}');
                                    var icons10 = new H.map.Icon('{{ asset('bundles/ffbb/images/icon10.png') }}');
                                    var icons11 = new H.map.Icon('{{ asset('bundles/ffbb/images/icon11.png') }}');
                                    var icons12 = new H.map.Icon('{{ asset('bundles/ffbb/images/icon12.png') }}');
                                    var icons13 = new H.map.Icon('{{ asset('bundles/ffbb/images/icon13.png') }}');
                                    var icons14 = new H.map.Icon('{{ asset('bundles/ffbb/images/icon14.png') }}');
                                    var icons15 = new H.map.Icon('{{ asset('bundles/ffbb/images/icon15.png') }}');
                                    var icons16 = new H.map.Icon('{{ asset('bundles/ffbb/images/icon16.png') }}');
                                    var icons17 = new H.map.Icon('{{ asset('bundles/ffbb/images/icon17.png') }}');
                                    var icons18 = new H.map.Icon('{{ asset('bundles/ffbb/images/icon18.png') }}');
                                    var icons19 = new H.map.Icon('{{ asset('bundles/ffbb/images/icon19.png') }}');
                                    var icons20 = new H.map.Icon('{{ asset('bundles/ffbb/images/icon20.png') }}');
                                    var icons21 = new H.map.Icon('{{ asset('bundles/ffbb/images/icon21.png') }}');
                                    var icons22 = new H.map.Icon('{{ asset('bundles/ffbb/images/icon22.png') }}');
                                    var icons23 = new H.map.Icon('{{ asset('bundles/ffbb/images/icon23.png') }}');
                                    var icons24 = new H.map.Icon('{{ asset('bundles/ffbb/images/icon24.png') }}');
                                    var icons25 = new H.map.Icon('{{ asset('bundles/ffbb/images/icon25.png') }}');

                                    //construction des points de differentes villes
                                    function addMarkersAndSetViewBounds() {
                                        var incrment = 1;
                                        var points = [];
                                        var incrementIcons = 0;

                                        {%  for poule, coordPoule in coordPoules %}

                                        //tracer dynamiquement les points de villes
                                        {% for coordonneeVille in coordPoule %}
                                        var x = '{{ coordonneeVille[0]}}';
                                        var y = '{{ coordonneeVille[1]}}';
//
                                        var xy = x+y;

//                                                                         var icon = 'icons' + incrementIcons;
                                        var icon = 'icons{{ poule-1 }}';
                                        var marker = 'marker' + incrment;
                                        window[marker] = new H.map.Marker({
                                            lat: parseFloat(x),
                                            lng: parseFloat(y)
                                        }, {icon: window[icon]}  );


                                        points.push(window[marker]);

                                        var incrment = incrment + 1;

                                        {% endfor %}
                                        incrementIcons++;
                                        {% endfor %}
                                        group = new H.map.Group();
                                        // add markers to the group
                                        group.addObjects(points);
                                        map.addObject(group);
                                        // get geo bounding box for the group and set it to the map
                                        map.setViewBounds(group.getBounds());
                                    }



                                    /**
                                     * Boilerplate map initialization code starts below:
                                     */

                                    //Step 1: initialize communication with the platform
                                    var platform = new H.service.Platform({
                                        app_id: '{{ app_id }}',
                                        app_code: '{{ app_code }}',
                                        useCIT: true,
                                        useHTTPS: true
                                    });
                                    var defaultLayers = platform.createDefaultLayers();

                                    //Step 2: initialize a map - this map is centered over Europe
                                    var map = new H.Map(document.getElementById('map'),
                                            defaultLayers.normal.map, {
                                                center: {lat: 48.8567, lng: 2.3508},
                                                zoom: 3
                                            });

                                    var behavior = new H.mapevents.Behavior(new H.mapevents.MapEvents(map));
                                    // Create the default UI components
                                    //    var ui = H.ui.UI.createDefault(map, defaultLayers);
                                    var ui = H.ui.UI.createDefault(map, defaultLayers, 'fr-FR');

                                    // Now use the map as required...
                                    // Add the marker to the map:
                                    // map.addObject(markerPrincipal);
                                    addMarkersAndSetViewBounds(map);
                                    switchMapLanguage(map, platform);

                                </script>
                                <!-- Nav tabs -->
                                <ul class="nav nav-tabs">
                                    <li class="active"><a href="#Estimations" data-toggle="tab">Estimations</a>
                                    </li>
                                    <li><a href="#Details" data-toggle="tab">Détails</a>
                                    </li>
                                    <li><a href="#listeRencontresScOpt" data-toggle="tab">Liste des rencontres</a></li>
                                </ul>

                                <!-- Tab panes -->
                                <div class="tab-content">
                                    <div class="tab-pane fade in active" id="Estimations">

                                        <div class="list-group">

                                            <p class="list-group-item">
                                                <i class="fa fa-road fa-fw"
                                                   style="padding-right: 30px"></i> <strong> {{ distanceMin|number_format(0, ',', ' ') }} </strong>
                                                Kms au total
                                                à parcourir pour l'ensemble du scénario
                                            </p>
                                            <p href="#" class="list-group-item">
                                                <img src="{{ asset('bundles/ffbb/images/icons/money-icon.png') }}"
                                                     width="20px" height="20px"/>
                                                <i style="padding-right: 10px"></i> <strong>{{ (distanceTotale * 0.80 )|round|number_format(0, ',', ' ') }}</strong>
                                                € pour réaliser les trajets de l'ensemble du scénario
                                                en voiture

                                            </p>
                                            <p href="#" class="list-group-item">
                                                <img src="{{ asset('bundles/ffbb/images/icons/money-icon.png') }}"
                                                     width="20px" height="20px"/>
                                                <i style="padding-right: 10px"></i> <strong>{{ (distanceTotale /4 * 0.80 )|round|number_format(0, ',', ' ') }} </strong>
                                                € pour réaliser les trajets de l'ensemble du scénario
                                                covoiturage

                                            </p>

                                            <p class="list-group-item">
                                                <img src="{{ asset('bundles/ffbb/images/icons/money-icon.png') }}"
                                                     width="20px" height="20px"/>
                                                <i style="padding-right: 10px"></i>
                                                <strong>{{ (distanceTotale /9 * 1.31)|round|number_format(0, ',', ' ') }} </strong>
                                                € pour réaliser les trajets de l'ensemble du scénario
                                                en minibus

                                            </p>
                                            <p class="list-group-item">
                                                <img src="{{ asset('bundles/ffbb/images/icons/car-icon.png') }}"
                                                     width="20px" height="20px"/>
                                                <i style="padding-right: 10px"></i> <strong>{{ (distanceTotale * 0.157)|round|number_format(0, ',', ' ') }} </strong>
                                                KG eq CO2 d'émissions totales de GES pour {{ nbrParticipantsTotal }}
                                                joueurs en voiture individuelle
                                                pour le scénario

                                            </p>
                                            <p class="list-group-item">
                                                <img src="{{ asset('bundles/ffbb/images/icons/covoiturage-icon.png') }}"
                                                     width="20px" height="20px"/>
                                                <i style="padding-right: 10px"></i> <strong>{{ (distanceTotale/4 * 0.157)|round|number_format(0, ',', ' ') }} </strong>
                                                KG eq CO2 d'émissions totales de GES pour {{ nbrParticipantsTotal }}
                                                joueurs en co-voiturage pour le scénario

                                            </p>

                                            <p class="list-group-item">
                                                <img src="{{ asset('bundles/ffbb/images/icons/bus-icon.png') }}"
                                                     width="20px" height="15px"/>
                                                <i style="padding-right: 10px"></i>
                                                <strong>{{ (distanceTotale/9 * 0.185)|round|number_format(0, ',', ' ') }} </strong>
                                                KG eq CO2 d'émissions totales de GES pour {{ nbrParticipantsTotal }}
                                                joueurs en minibus pour le scénario

                                            </p>

                                        </div>


                                    </div>

                                    <div class="tab-pane fade" id="Details">
                                        <div class="table-responsive" style="padding-top: 10px">

                                            <table id="example" class="display" cellspacing="0"
                                                   width="100%">
                                                <thead>
                                                <tr>
                                                    <th style="font-weight: bold !important;">
                                                        Participants
                                                    </th>
                                                    <th>Kms à
                                                        parcourir
                                                    </th>
                                                    <th>Temps de parcours
                                                        (J H:M)
                                                    </th>
                                                    <th>Coût du parcours en
                                                        voiture(€)
                                                    </th>
                                                    <th>Coût du parcours en
                                                        covoiturage(€)
                                                    </th>
                                                    <th>Coût du parcours en
                                                        minibus(€)
                                                    </th>
                                                    <th>Emissions GES voiture
                                                        individuelle (en KG eq CO2)
                                                    </th>
                                                    <th>Emissions GES
                                                        covoiturage (en KG eq CO2)
                                                    </th>

                                                    <th>Emissions GES minibus
                                                        (en KG eq CO2)
                                                    </th>
                                                </tr>
                                                </thead>
                                                <tbody>
                                                {% set dureeTotaleScOptContrainte = "" %}
                                                {% for key, estimationDetailOptContrainte in estimationDetailsOptContrainte %}
                                                    {% set distanceOptContrainteDetail = estimationDetailsOptContrainte[ key ].distanceTotale // 1000 %}
                                                    {% set distanceTotaleOptContrainteDetail = estimationDetailsOptContrainte[ key ].distanceTotaleTousParticipants // 1000 %}
                                                    {% set dureeTotaleOptContrainteDetail = estimationDetailsOptContrainte[ key ].dureeTotale  %}
                                                    {% set nbrParticipantsOptContrainteDetail = estimationDetailsOptContrainte[ key ].nbrParticipantsTotal  %}
                                                    {% set lettre = alphabet[key-1] %}
                                                    <tr>
                                                        <td><strong> Poule {{ lettre }} </strong></td>
                                                        <td style="text-align:right"> {{ distanceOptContrainteDetail|number_format(0, ',', ' ') }}</td>
                                                        <td style="text-align:center">

                                                            {# récupérer le nbr de jour #}
                                                            {% set nbrJourOptContrainteDetail = (dureeTotaleOptContrainteDetail/86400)|round %}
                                                            {% if nbrJourOptContrainteDetail <10 %}
                                                                {% set nbrJourOptContrainteDetail = "0"~nbrJourOptContrainteDetail %}
                                                            {% endif %}
                                                            {# récupérer le nbr d heure #}
                                                            {% set nbrHeureOptContrainteDetail = ((dureeTotaleOptContrainteDetail%86400)/3600)|round %}
                                                            {% if nbrHeureOptContrainteDetail <10 %}
                                                                {% set nbrHeureOptContrainteDetail = "0"~nbrHeureOptContrainteDetail %}
                                                            {% endif %}
                                                            {# récupérer le nbr de minute #}
                                                            {% set nbrMinOptContrainteDetail = (((dureeTotaleOptContrainteDetail%86400)%3600)/60)|round %}
                                                            {% if nbrMinOptContrainteDetail <10 %}
                                                                {% set nbrMinOptContrainteDetail = "0"~nbrMinOptContrainteDetail %}
                                                            {% endif %}
                                                            {{ nbrJourOptContrainteDetail}} {{ nbrHeureOptContrainteDetail }}:{{ nbrMinOptContrainteDetail }}
                                                        </td>
                                                        <td style="text-align:right"> {{ (distanceTotaleOptContrainteDetail  * 0.80)|round|number_format(0, ',', ' ') }}</td>
                                                        <td style="text-align:right"> {{ (distanceTotaleOptContrainteDetail /4 * 0.80)|round|number_format(0, ',', ' ') }}</td>
                                                        <td style="text-align:right"> {{ (distanceTotaleOptContrainteDetail /9 * 1.31)|round|number_format(0, ',', ' ') }}</td>
                                                        <td style="text-align:right"> {{ (distanceTotaleOptContrainteDetail * 0.157)|round|number_format(0, ',', ' ') }}</td>
                                                        <td style="text-align:right"> {{ ((distanceTotaleOptContrainteDetail /4)*0.157)|round|number_format(0, ',', ' ')  }} </td>
                                                        <td style="text-align:right"> {{ ((distanceTotaleOptContrainteDetail /9)*0.185)|round|number_format(0, ',', ' ') }} </td>
                                                    </tr>
                                                    {% set dureeTotaleScOptContrainte = dureeTotaleScOptContrainte + dureeTotaleOptContrainteDetail %}
                                                {% endfor %}
                                                <tr>
                                                    <td><strong> Totaux </strong></td>
                                                    <td style="text-align:right"> {{ distanceMin|number_format(0, ',', ' ') }}</td>
                                                    <td style="text-align:center">

                                                        {# récupérer le nbr de jour #}
                                                        {% set nbrJourScOptContrainte = (dureeTotaleScOptContrainte/86400)|round %}
                                                        {% if nbrJourScOptContrainte <10 %}
                                                            {% set nbrJourScOptContrainte = "0"~nbrJourScOptContrainte %}
                                                        {% endif %}
                                                        {# récupérer le nbr d heure #}
                                                        {% set nbrHeureScOptContrainte = ((dureeTotaleScOptContrainte%86400)/3600)|round %}
                                                        {% if nbrHeureScOptContrainte <10 %}
                                                            {% set nbrHeureScOptContrainte = "0"~nbrHeureScOptContrainte %}
                                                        {% endif %}
                                                        {# récupérer le nbr de minute #}
                                                        {% set nbrMinScOptContrainte = (((dureeTotaleScOptContrainte%86400)%3600)/60)|round %}
                                                        {% if nbrMinScOptContrainte <10 %}
                                                            {% set nbrMinScOptContrainte = "0"~nbrMinScOptContrainte %}
                                                        {% endif %}
                                                        {{ nbrJourScOptContrainte}} {{ nbrHeureScOptContrainte }}:{{ nbrMinScOptContrainte }}

                                                    </td>
                                                    <td style="text-align:right"> {{ (distanceTotale  * 0.80)|round|number_format(0, ',', ' ') }}</td>
                                                    <td style="text-align:right"> {{ (distanceTotale /4 * 0.80)|round|number_format(0, ',', ' ') }}</td>
                                                    <td style="text-align:right"> {{ (distanceTotale /9 * 1.31)|round|number_format(0, ',', ' ') }}</td>
                                                    <td style="text-align:right"> {{ (distanceTotale * 0.157)|round|number_format(0, ',', ' ') }}</td>
                                                    <td style="text-align:right"> {{ ((distanceTotale /4)*0.157)|round|number_format(0, ',', ' ')  }} </td>
                                                    <td style="text-align:right"> {{ ((distanceTotale /9)*0.185)|round|number_format(0, ',', ' ') }} </td>
                                                </tr>


                                                </tbody>
                                            </table>

                                        </div>
                                        <!-- /.table-responsive -->
                                    </div>

                                    <div class="tab-pane fade" id="listeRencontresScOpt">
                                        <div class="table-responsive" style="padding-top: 10px; max-height: 400px; overflow-y: scroll;">

                                            <table id="scOpAvecContrainte" class="display"
                                                   cellspacing="0"
                                                   width="100%">


                                                {% if typeMatch == "allerRetour" or typeMatch == "allerSimple" %}


                                                    <thead>
                                                    <tr>
                                                        <th style="font-weight: bold !important;">
                                                            Poules
                                                        </th>
                                                        <th>Rencontres</th>

                                                    </tr>
                                                    </thead>
                                                    <tbody>


                                                    {% for key, rencontreDetailOptContrainte in rencontreDetailsOptContrainte %}
                                                        {% set distanceOptContrainte = rencontreDetailsOptContrainte[ key ] %}
                                                        {% set lettre = alphabet[key-1] %}
                                                        <tr>
                                                            <td><strong> Poule {{ lettre }} </strong></td>

                                                            <td>
                                                                <ul>
                                                                    {% for keyDetail, detailsRencontreOpContrainte in distanceOptContrainte %}
                                                                        <li>
                                                                            {{ distanceOptContrainte[ loop.index ].equipeDepartNom }} ~ {{ distanceOptContrainte[ loop.index ].equipeDestinationNom }}
                                                                        </li>

                                                                    {% endfor %}
                                                                </ul>
                                                            </td>
                                                        </tr>

                                                    {% endfor %}
                                                    </tbody>
                                                {% elseif typeMatch == 'plateau' %}

                                                    <thead>
                                                    <tr>
                                                        <th style="font-weight: bold !important;">Poules</th>
                                                        <th>Journée</th>
                                                        <th>Equipe hôte</th>
                                                        <th>Equipes adverses</th>

                                                    </tr>
                                                    </thead>
                                                    <tbody>

                                                    {% for poule, contenuPoule in rencontreDetailsOptContrainte %}
                                                        {% set lettre = alphabet[poule-1] %}
                                                        {% for journee, contenuJournee in contenuPoule %}
                                                            <tr>
                                                                <td ><strong> Poule {{ lettre }}  </strong></td>
                                                                <td>
                                                                    {{ journee }}
                                                                </td>
                                                                <td>
                                                                    {% for contenuGroup in contenuJournee %}
                                                                        {{ contenuGroup.hoteNom }} <br/> <br/>
                                                                    {% endfor %}
                                                                </td>
                                                                <td>
                                                                    {% for contenuGroup in contenuJournee %}
                                                                        * {{ contenuGroup.premierEquipeNom }} <br/>
                                                                        * {{ contenuGroup.deuxiemeEquipeNom }} <br/>
                                                                    {% endfor %}
                                                                </td>

                                                            </tr>

                                                        {% endfor %}


                                                    {% endfor %}
                                                    </tbody>



                                                {% endif %}


                                            </table>

                                        </div>
                                        <!-- /.table-responsive -->
                                    </div>

                                    <a href="{{ path('ffbb_poules_details_calcul') }}" class="pull-left">Détails du calcul</a>

                                    {#<form name="submitParams" action="{{ path('ffbb_poules_previsualisation_export')}}" method="post">#}
                                    <form name="submitParams" action="{{ path('ffbb_poules_pretraitement_export')}}" method="post">
                                        <input type="hidden" value="{{ idResultat }}" name="idResultat">
                                        <input type="hidden" value="optimalAvecContrainte" name="typeScenario" >

                                        <select onchange="this.form.submit()"  class="btn btn-primary pull-right" name="formatExport" >
                                            <option value="" disabled="disabled" selected="selected">Choisir un format d'export</option>
                                            <option value="pdf">Exporter en PDF</option>
                                            <option value="xml">Exporter en XML</option>
                                            <option value="csv">Exporter en CSV</option>
                                        </select>

                                    </form>



                                    {#<form name="submitParams" action="{{ path('ffbb_previsualisation_pdf')}}" method="post">#}
                                        {#<input type="hidden" value="{{ idResultat }}" name="idResultat">#}
                                        {#<input type="hidden" value="optimalAvecContrainte" name="typeScenario" >#}

                                        {#<button type="submit" class="btn btn-primary  pull-right">Exporter</button>#}
                                    {#</form>#}




                                </div>

                            </div>
                        </div>
                    </div>


                </div>
            </div>
            <!-- .panel-body -->
            <!-- /.panel -->
        </div>
        <!-- /.col-lg-6 -->

        <!-- Scénario équitable avec contrainte -->
        <div class="col-lg-6">

            <!-- declaration de variables -->
            <!-- distanceMin -->
            {% set distanceMinEqContrainte = scenarioEquitableAvecContrainte.estimationGenerale.distanceTotale %}
            {% set distanceMinEqContrainte = (distanceMinEqContrainte / 1000)|round %}
            <!-- distanceTotale -->
            {% set distanceTotaleEqContrainte = scenarioEquitableAvecContrainte.estimationGenerale.distanceTotaleTousParticipants %}
            {% set distanceTotaleEqContrainte = (distanceTotaleEqContrainte / 1000)|round %}
            <!-- nbrParticipantsTotal -->
            {% set nbrParticipantsTotalEqContrainte = scenarioEquitableAvecContrainte.estimationGenerale.nbrParticipantsTotal %}
            <!-- dureeTotale -->
            {% set dureeTotaleEqContrainte = scenarioEquitableAvecContrainte.estimationGenerale.dureeTotale %}
            <!-- estimationDetails -->
            {% set estimationDetailsEqContrainte = scenarioEquitableAvecContrainte.estimationDetails %}
            <!-- rencontreDetails -->
            {% set rencontreDetailsEqContrainte = scenarioEquitableAvecContrainte.rencontreDetails %}
            <!-- coordPoules -->
            {% set coordPoulesEqAvecContrainte = scenarioEquitableAvecContrainte.poulesCoords %}

            <div class="panel-body">
                <div class="panel-group" id="scEquitableAvecContrainte">
                    <div class="panel panel-default">
                        <div class="panel-heading">
                            <h4 class="panel-title">
                                Scénario équitable
                            </h4>
                        </div>
                        <div class="panel-body"> <!-- premier scÃ©nario -->
                            <div id="mapEquitable"
                                 style="width: 100%; height: 500px; background: grey"></div>
                            <script type="text/javascript" charset="UTF-8">

                                /**
                                 *
                                 * Changer la langue de la carte
                                 */
                                function switchMapLanguage(map, platform) {
                                    var mapTileService = platform.getMapTileService({
                                                type: 'base'
                                            }),
                                            frenchMapLayer = mapTileService.createTileLayer(
                                                    'maptile',
                                                    'normal.day',
                                                    256,
                                                    'png8',
                                                    {lg: 'fre'}
                                            );
                                    map.setBaseLayer(frenchMapLayer);


                                }
                                /*
                                 Fin fn changer langue
                                 */

                                // Create a marker icon from an image URL:

                                var icons0 = new H.map.Icon('{{ asset('bundles/ffbb/images/icon0.png') }}');
                                var icons1 = new H.map.Icon('{{ asset('bundles/ffbb/images/icon1.png') }}');
                                var icons2 = new H.map.Icon('{{ asset('bundles/ffbb/images/icon2.png') }}');
                                var icons3 = new H.map.Icon('{{ asset('bundles/ffbb/images/icon3.png') }}');
                                var icons4 = new H.map.Icon('{{ asset('bundles/ffbb/images/icon4.png') }}');
                                var icons5 = new H.map.Icon('{{ asset('bundles/ffbb/images/icon5.png') }}');
                                var icons6 = new H.map.Icon('{{ asset('bundles/ffbb/images/icon6.png') }}');
                                var icons7 = new H.map.Icon('{{ asset('bundles/ffbb/images/icon7.png') }}');
                                var icons8 = new H.map.Icon('{{ asset('bundles/ffbb/images/icon8.png') }}');
                                var icons9 = new H.map.Icon('{{ asset('bundles/ffbb/images/icon9.png') }}');
                                var icons10 = new H.map.Icon('{{ asset('bundles/ffbb/images/icon10.png') }}');
                                var icons11 = new H.map.Icon('{{ asset('bundles/ffbb/images/icon11.png') }}');
                                var icons12 = new H.map.Icon('{{ asset('bundles/ffbb/images/icon12.png') }}');
                                var icons13 = new H.map.Icon('{{ asset('bundles/ffbb/images/icon13.png') }}');
                                var icons14 = new H.map.Icon('{{ asset('bundles/ffbb/images/icon14.png') }}');
                                var icons15 = new H.map.Icon('{{ asset('bundles/ffbb/images/icon15.png') }}');
                                var icons16 = new H.map.Icon('{{ asset('bundles/ffbb/images/icon16.png') }}');
                                var icons17 = new H.map.Icon('{{ asset('bundles/ffbb/images/icon17.png') }}');
                                var icons18 = new H.map.Icon('{{ asset('bundles/ffbb/images/icon18.png') }}');
                                var icons19 = new H.map.Icon('{{ asset('bundles/ffbb/images/icon19.png') }}');
                                var icons20 = new H.map.Icon('{{ asset('bundles/ffbb/images/icon20.png') }}');
                                var icons21 = new H.map.Icon('{{ asset('bundles/ffbb/images/icon21.png') }}');
                                var icons22 = new H.map.Icon('{{ asset('bundles/ffbb/images/icon22.png') }}');
                                var icons23 = new H.map.Icon('{{ asset('bundles/ffbb/images/icon23.png') }}');
                                var icons24 = new H.map.Icon('{{ asset('bundles/ffbb/images/icon24.png') }}');
                                var icons25 = new H.map.Icon('{{ asset('bundles/ffbb/images/icon25.png') }}');
                                //construction des points de differentes villes
                                function addMarkersAndSetViewBounds() {
                                    var incrment = 1;
                                    var points = [];
                                    var incrementIcons = 0;
                                    {%  for poule, coordPouleEqAvecContrainte in coordPoulesEqAvecContrainte %}

                                    //tracer dynamiquement les points de villes
                                    {% for coordonneeVilleEqAvecContrainte in coordPouleEqAvecContrainte %}
                                    var x = '{{ coordonneeVilleEqAvecContrainte[0]}}';
                                    var y = '{{ coordonneeVilleEqAvecContrainte[1]}}';
//
                                    var xy = x+y;

//                                                                 var icon = 'icons' + incrementIcons;
                                    var icon = 'icons{{ poule-1 }}' ;

                                    var marker = 'marker' + incrment;
                                    window[marker] = new H.map.Marker({
                                        lat: parseFloat(x),
                                        lng: parseFloat(y)
                                    }, {icon: window[icon]}  );


                                    points.push(window[marker]);

                                    var incrment = incrment + 1;

                                    {% endfor %}
                                    incrementIcons++;
                                    {% endfor %}
                                    group = new H.map.Group();
                                    // add markers to the group
                                    group.addObjects(points);
                                    map.addObject(group);
                                    // get geo bounding box for the group and set it to the map
                                    map.setViewBounds(group.getBounds());
                                }



                                /**
                                 * Boilerplate map initialization code starts below:
                                 */

                                //Step 1: initialize communication with the platform
                                var platform = new H.service.Platform({
                                    app_id: '{{ app_id }}',
                                    app_code: '{{ app_code }}',
                                    useCIT: true,
                                    useHTTPS: true
                                });
                                var defaultLayers = platform.createDefaultLayers();

                                //Step 2: initialize a map - this map is centered over Europe
                                var map = new H.Map(document.getElementById('mapEquitable'),
                                        defaultLayers.normal.map, {
                                            center: {lat: 48.8567, lng: 2.3508},
                                            zoom: 3
                                        });

                                var behavior = new H.mapevents.Behavior(new H.mapevents.MapEvents(map));
                                // Create the default UI components
                                //    var ui = H.ui.UI.createDefault(map, defaultLayers);
                                var ui = H.ui.UI.createDefault(map, defaultLayers, 'fr-FR');

                                // Now use the map as required...
                                // Add the marker to the map:
                                // map.addObject(markerPrincipal);
                                addMarkersAndSetViewBounds(map);
                                switchMapLanguage(map, platform);

                            </script>
                            <!-- Nav tabs -->
                            <ul class="nav nav-tabs">
                                <li class="active"><a href="#EstimationsEq" data-toggle="tab">Estimations</a>
                                </li>
                                <li><a href="#DetailsEq" data-toggle="tab">Détails</a>
                                </li>
                                <li><a href="#listeRencontresScEq" data-toggle="tab">Liste des rencontres</a>
                                </li>

                            </ul>

                            <!-- Tab panes -->
                            <div class="tab-content">
                                <div class="tab-pane fade in active" id="EstimationsEq">

                                    <div class="list-group">

                                        <p class="list-group-item">
                                            <i class="fa fa-road fa-fw"
                                               style="padding-right: 30px"></i> <strong> {{ distanceMinEqContrainte|number_format(0, ',', ' ') }} </strong>
                                            Kms au total
                                            à parcourir pour l'ensemble du scénario
                                        </p>
                                        <p class="list-group-item">
                                            <img src="{{ asset('bundles/ffbb/images/icons/money-icon.png') }}"
                                                 width="20px" height="20px"/>
                                            <i style="padding-right: 10px"></i> <strong>{{ (distanceTotaleEqContrainte * 0.80 )|round|number_format(0, ',', ' ') }} </strong>
                                            € pour réaliser les trajets de l'ensemble du scénario
                                            en voiture

                                        </p>
                                        <p class="list-group-item">
                                            <img src="{{ asset('bundles/ffbb/images/icons/money-icon.png') }}"
                                                 width="20px" height="20px"/>
                                            <i style="padding-right: 10px"></i> <strong>{{ (distanceTotaleEqContrainte /4 * 0.80 )|round|number_format(0, ',', ' ') }} </strong>
                                            € pour réaliser les trajets de l'ensemble du scénario
                                            en covoiturage

                                        </p>
                                        <p class="list-group-item">
                                            <img src="{{ asset('bundles/ffbb/images/icons/money-icon.png') }}"
                                                 width="20px" height="20px"/>
                                            <i style="padding-right: 10px"></i>
                                            <strong>{{ (distanceTotaleEqContrainte /9 * 1.31)|round|number_format(0, ',', ' ') }} </strong>
                                            € pour réaliser les trajets de l'ensemble du scénario
                                            en minibus

                                        </p>

                                        <p class="list-group-item">
                                            <img src="{{ asset('bundles/ffbb/images/icons/car-icon.png') }}"
                                                 width="20px" height="20px"/>
                                            <i style="padding-right: 10px"></i> <strong>{{ (distanceTotaleEqContrainte * 0.157)|round|number_format(0, ',', ' ') }} </strong>
                                            KG eq CO2 d'émissions totales de GES pour {{ nbrParticipantsTotalEqContrainte }}
                                            joueurs en voiture individuelle
                                            pour le scénario

                                        </p>
                                        <p class="list-group-item">
                                            <img src="{{ asset('bundles/ffbb/images/icons/covoiturage-icon.png') }}"
                                                 width="20px" height="20px"/>
                                            <i style="padding-right: 10px"></i> <strong> {{ (distanceTotaleEqContrainte/4 * 0.157)|round|number_format(0, ',', ' ') }} </strong>
                                            KG eq CO2 d'émissions totales de GES pour {{ nbrParticipantsTotalEqContrainte }}
                                            joueurs en co-voiturage pour le scénario

                                        </p>

                                        <p class="list-group-item">
                                            <img src="{{ asset('bundles/ffbb/images/icons/bus-icon.png') }}"
                                                 width="20px" height="15px"/>
                                            <i style="padding-right: 10px"></i>
                                            <strong> {{ (distanceTotaleEqContrainte/9 * 0.185)|round|number_format(0, ',', ' ') }}</strong>
                                            KG eq CO2 d'émissions totales de GES pour {{ nbrParticipantsTotalEqContrainte }}
                                            joueurs en minibus pour le scénario

                                        </p>

                                    </div>


                                </div>
                                <div class="tab-pane fade" id="DetailsEq">
                                    <div class="table-responsive" style="padding-top: 10px">

                                        <table id="exampleExclusion" class="display"
                                               cellspacing="0"
                                               width="100%">
                                            <thead>
                                            <tr>
                                                <th style="font-weight: bold !important;">
                                                    Participants
                                                </th>
                                                <th>Kms à
                                                    parcourir
                                                </th>
                                                <th>Temps de parcours
                                                    (J H:M)
                                                </th>
                                                <th>Coût du parcours en
                                                    voiture(€)
                                                </th>
                                                <th >Coût du parcours en
                                                    covoiturage(€)
                                                </th>
                                                <th >Coût du parcours en
                                                    minibus(€)
                                                </th>
                                                <th >Emissions GES voiture
                                                    individuelle (en KG eq CO2)
                                                </th>
                                                <th >Emissions GES
                                                    covoiturage (en KG eq CO2)
                                                </th>

                                                <th>Emissions GES minibus
                                                    (en KG eq CO2)
                                                </th>
                                            </tr>
                                            </thead>
                                            <tbody>

                                            {% set dureeTotaleScEqContrainte = "" %}
                                            {% for key, estimationDetailEqContrainte in estimationDetailsEqContrainte %}
                                                {% set distanceEqContrainteDetail = estimationDetailsEqContrainte[ key ].distanceTotale // 1000 %}
                                                {% set distanceTotaleEqContrainteDetail = estimationDetailsEqContrainte[ key ].distanceTotaleTousParticipants // 1000 %}
                                                {% set dureeTotaleEqContrainteDetail = estimationDetailsEqContrainte[ key ].dureeTotale  %}
                                                {% set nbrParticipantsEqContrainteDetail = estimationDetailsEqContrainte[ key ].nbrParticipantsTotal  %}
                                                {% set lettre = alphabet[key-1] %}
                                                <tr>
                                                    <td><strong> Poule {{ lettre }} </strong></td>
                                                    <td style="text-align:right"> {{ distanceEqContrainteDetail|number_format(0, ',', ' ') }}</td>
                                                    <td style="text-align:center">

                                                        {# récupérer le nbr de jour #}
                                                        {% set nbrJour = (dureeTotaleEqContrainteDetail/86400)|round %}
                                                        {% if nbrJour <10 %}
                                                            {% set nbrJour = "0"~nbrJour %}
                                                        {% endif %}
                                                        {# récupérer le nbr d heure #}
                                                        {% set nbrHeure = ((dureeTotaleEqContrainteDetail%86400)/3600)|round %}
                                                        {% if nbrHeure <10 %}
                                                            {% set nbrHeure = "0"~nbrHeure %}
                                                        {% endif %}
                                                        {# récupérer le nbr de minute #}
                                                        {% set nbrMin = (((dureeTotaleEqContrainteDetail%86400)%3600)/60)|round %}
                                                        {% if nbrMin <10 %}
                                                            {% set nbrMin = "0"~nbrMin %}
                                                        {% endif %}
                                                        {{ nbrJour}} {{ nbrHeure }}:{{ nbrMin }}

                                                    </td>
                                                    <td style="text-align:right"> {{ (distanceTotaleEqContrainteDetail  * 0.80)|round|number_format(0, ',', ' ') }}</td>
                                                    <td style="text-align:right"> {{ (distanceTotaleEqContrainteDetail /4 * 0.80)|round|number_format(0, ',', ' ') }}</td>
                                                    <td style="text-align:right"> {{ (distanceTotaleEqContrainteDetail /9 * 1.31)|round|number_format(0, ',', ' ') }}</td>
                                                    <td style="text-align:right"> {{ (distanceTotaleEqContrainteDetail * 0.157)|round|number_format(0, ',', ' ') }}</td>
                                                    <td style="text-align:right"> {{ ((distanceTotaleEqContrainteDetail /4)*0.157)|round|number_format(0, ',', ' ')  }} </td>
                                                    <td style="text-align:right"> {{ ((distanceTotaleEqContrainteDetail /9)*0.185)|round|number_format(0, ',', ' ') }} </td>
                                                </tr>
                                                {% set dureeTotaleScEqContrainte = dureeTotaleScEqContrainte + dureeTotaleEqContrainteDetail %}
                                            {% endfor %}
                                            <tr>
                                                <td><strong> Totaux </strong></td>
                                                <td style="text-align:right"> {{distanceMinEqContrainte|number_format(0, ',', ' ') }}</td>
                                                <td style="text-align:center">

                                                    {# récupérer le nbr de jour #}
                                                    {% set nbrJourScEqContrainte = (dureeTotaleScEqContrainte/86400)|round %}
                                                    {% if nbrJourScEqContrainte <10 %}
                                                        {% set nbrJourScEqContrainte = "0"~nbrJourScEqContrainte %}
                                                    {% endif %}
                                                    {# récupérer le nbr d heure #}
                                                    {% set nbrHeureScEqContrainte = ((dureeTotaleScEqContrainte%86400)/3600)|round %}
                                                    {% if nbrHeureScEqContrainte <10 %}
                                                        {% set nbrHeureScEqContrainte = "0"~nbrHeureScEqContrainte %}
                                                    {% endif %}
                                                    {# récupérer le nbr de minute #}
                                                    {% set nbrMinScEqContrainte = (((dureeTotaleScEqContrainte%86400)%3600)/60)|round %}
                                                    {% if nbrMinScEqContrainte <10 %}
                                                        {% set nbrMinScEqContrainte = "0"~nbrMinScEqContrainte %}
                                                    {% endif %}
                                                    {{ nbrJourScEqContrainte }} {{ nbrHeureScEqContrainte }}:{{ nbrMinScEqContrainte }}


                                                </td>
                                                <td style="text-align:right"> {{ (distanceTotaleEqContrainte  * 0.80)|round|number_format(0, ',', ' ') }}</td>
                                                <td style="text-align:right"> {{ (distanceTotaleEqContrainte /4 * 0.80)|round|number_format(0, ',', ' ') }}</td>
                                                <td style="text-align:right"> {{ (distanceTotaleEqContrainte /9 * 1.31)|round|number_format(0, ',', ' ') }}</td>
                                                <td style="text-align:right"> {{ (distanceTotaleEqContrainte * 0.157)|round|number_format(0, ',', ' ') }}</td>
                                                <td style="text-align:right"> {{ ((distanceTotaleEqContrainte /4)*0.157)|round|number_format(0, ',', ' ')  }} </td>
                                                <td style="text-align:right"> {{ ((distanceTotaleEqContrainte/9)*0.185)|round|number_format(0, ',', ' ') }} </td>
                                            </tr>

                                            </tbody>
                                        </table>

                                    </div>
                                    <!-- /.table-responsive -->
                                </div>

                                <div class="tab-pane fade" id="listeRencontresScEq">
                                    <div class="table-responsive" style="padding-top: 10px; max-height: 400px; overflow-y: scroll;">

                                        <table id="scEqAvecContrainte" class="display"
                                               cellspacing="0"
                                               width="100%">
                                            {% if typeMatch == "allerRetour" or typeMatch == "allerSimple" %}
                                                <thead>
                                                <tr>
                                                    <th style="font-weight: bold !important;">
                                                        Poules
                                                    </th>
                                                    <th>Rencontres</th>

                                                </tr>
                                                </thead>
                                                <tbody>

                                                {% for keyEqContrainte, rencontreDetailEqContrainte in rencontreDetailsEqContrainte %}
                                                    {% set distanceEqContrainte = rencontreDetailsEqContrainte[ keyEqContrainte ] %}
                                                    {% set lettre = alphabet[keyEqContrainte-1] %}

                                                    <tr>
                                                        <td><strong> Poule {{ lettre }} </strong></td>

                                                        <td>
                                                            <ul>
                                                                {% for detailsRencontreEqContrainte in distanceEqContrainte %}
                                                                    <li>
                                                                        {{ distanceEqContrainte[ loop.index ].equipeDepartNom }} ~ {{ distanceEqContrainte[ loop.index ].equipeDestinationNom }}
                                                                    </li>

                                                                {% endfor %}
                                                            </ul>
                                                        </td>


                                                    </tr>
                                                {% endfor %}
                                                </tbody>
                                            {% elseif typeMatch == 'plateau' %}


                                                <thead>
                                                <tr>
                                                    <th style="font-weight: bold !important;">Poules</th>
                                                    <th>Journée</th>
                                                    <th>Equipe hôte</th>
                                                    <th>Equipes adverses</th>

                                                </tr>
                                                </thead>
                                                <tbody>

                                                {% for poule, contenuPoule in rencontreDetailsEqContrainte %}
                                                    {% set lettre = alphabet[poule-1] %}
                                                    {% for journee, contenuJournee in contenuPoule %}
                                                        <tr>
                                                            <td ><strong> Poule {{ lettre }}  </strong></td>
                                                            <td>
                                                                {{ journee }}
                                                            </td>
                                                            <td>
                                                                {% for contenuGroup in contenuJournee %}
                                                                    {{ contenuGroup.hoteNom }} <br/> <br/>
                                                                {% endfor %}
                                                            </td>
                                                            <td>
                                                                {% for contenuGroup in contenuJournee %}
                                                                    * {{ contenuGroup.premierEquipeNom }} <br/>
                                                                    * {{ contenuGroup.deuxiemeEquipeNom }} <br/>
                                                                {% endfor %}
                                                            </td>

                                                        </tr>

                                                    {% endfor %}


                                                {% endfor %}
                                                </tbody>




                                            {% endif %}

                                        </table>

                                    </div>
                                    <!-- /.table-responsive -->
                                </div>
                                <a href="{{ path('ffbb_poules_details_calcul') }}" class="pull-left">Détails
                                    du calcul</a>

                                {#<form name="submitParams" action="{{ path('ffbb_poules_previsualisation_export')}}" method="post">#}
                                <form name="submitParams" action="{{ path('ffbb_poules_pretraitement_export')}}" method="post">
                                    <input type="hidden" value="{{ idResultat }}" name="idResultat">
                                    <input type="hidden" value="equitableAvecContrainte" name="typeScenario" >

                                    <select onchange="this.form.submit()"  class="btn btn-primary pull-right" name="formatExport" >
                                        <option value="" disabled="disabled" selected="selected">Choisir un format d'export</option>
                                        <option value="pdf">Exporter en PDF</option>
                                        <option value="xml">Exporter en XML</option>
                                        <option value="csv">Exporter en CSV</option>
                                    </select>

                                </form>


                                {#<form name="submitParams" action="{{ path('ffbb_previsualisation_pdf')}}" method="post">#}
                                    {#<input type="hidden" value="{{ idResultat }}" name="idResultat">#}
                                    {#<input type="hidden" value="equitableAvecContrainte" name="typeScenario" >#}

                                    {#<button type="submit" class="btn btn-primary  pull-right">Exporter</button>#}
                                {#</form>#}



                            </div>



                        </div>
                    </div>


                </div>
            </div>
            <!-- .panel-body -->
            <!-- /.panel -->
        </div>
        <!-- /.col-lg-6 -->

    </div>



    <!--  Scénarios optimal sans contrainte et scénario de réference -->
    <div class="row">
        <!-- Scénario optimal sans contrainte -->
        <div class="col-lg-6">

            <!-- declaration de variables -->
            <!-- distanceMin -->
            {% set distanceMinOpSansContrainte = scenarioOptimalSansContrainte.estimationGenerale.distanceTotale %}
            {% set distanceMinOpSansContrainte = (distanceMinOpSansContrainte / 1000)|round %}
            <!-- distanceTotale -->
            {% set distanceTotaleOpSansContrainte = scenarioOptimalSansContrainte.estimationGenerale.distanceTotaleTousParticipants %}
            {% set distanceTotaleOpSansContrainte = (distanceTotaleOpSansContrainte / 1000)|round %}
            <!-- nbrParticipantsTotal -->
            {% set nbrParticipantsTotalOpSansContrainte = scenarioOptimalSansContrainte.estimationGenerale.nbrParticipantsTotal %}
            <!-- dureeTotale -->
            {% set dureeTotaleOpSansContrainte = scenarioOptimalSansContrainte.estimationGenerale.dureeTotale %}
            <!-- estimationDetails -->
            {% set estimationDetailsOpSansContrainte = scenarioOptimalSansContrainte.estimationDetails %}
            <!-- rencontreDetails -->
            {% set rencontreDetailsOpSansContrainte = scenarioOptimalSansContrainte.rencontreDetails %}
            <!-- coordPoules -->
            {% set coordPoulesOpSansContrainte = scenarioOptimalSansContrainte.poulesCoords %}
            <div class="panel-body">
                <div class="panel-group" id="scOptimalSansContrainte">
                    <div class="panel panel-default">
                        <div class="panel-heading">
                            <h4 class="panel-title">
                                Scénario optimal sans contrainte
                            </h4>
                        </div>
                        <div class="panel-body"> <!-- premier scÃ©nario -->
                            <div id="mapOpSansContrainte"
                                 style="width: 100%; height: 500px; background: grey"></div>
                            <script type="text/javascript" charset="UTF-8">

                                /**
                                 *
                                 * Changer la langue de la carte
                                 */
                                function switchMapLanguage(map, platform) {
                                    var mapTileService = platform.getMapTileService({
                                                type: 'base'
                                            }),
                                            frenchMapLayer = mapTileService.createTileLayer(
                                                    'maptile',
                                                    'normal.day',
                                                    256,
                                                    'png8',
                                                    {lg: 'fre'}
                                            );
                                    map.setBaseLayer(frenchMapLayer);


                                }
                                /*
                                 Fin fn changer langue
                                 */
                                // Create a marker icon from an image URL:

                                var icons0 = new H.map.Icon('{{ asset('bundles/ffbb/images/icon0.png') }}');
                                var icons1 = new H.map.Icon('{{ asset('bundles/ffbb/images/icon1.png') }}');
                                var icons2 = new H.map.Icon('{{ asset('bundles/ffbb/images/icon2.png') }}');
                                var icons3 = new H.map.Icon('{{ asset('bundles/ffbb/images/icon3.png') }}');
                                var icons4 = new H.map.Icon('{{ asset('bundles/ffbb/images/icon4.png') }}');
                                var icons5 = new H.map.Icon('{{ asset('bundles/ffbb/images/icon5.png') }}');
                                var icons6 = new H.map.Icon('{{ asset('bundles/ffbb/images/icon6.png') }}');
                                var icons7 = new H.map.Icon('{{ asset('bundles/ffbb/images/icon7.png') }}');
                                var icons8 = new H.map.Icon('{{ asset('bundles/ffbb/images/icon8.png') }}');
                                var icons9 = new H.map.Icon('{{ asset('bundles/ffbb/images/icon9.png') }}');
                                var icons10 = new H.map.Icon('{{ asset('bundles/ffbb/images/icon10.png') }}');
                                var icons11 = new H.map.Icon('{{ asset('bundles/ffbb/images/icon11.png') }}');
                                var icons12 = new H.map.Icon('{{ asset('bundles/ffbb/images/icon12.png') }}');
                                var icons13 = new H.map.Icon('{{ asset('bundles/ffbb/images/icon13.png') }}');
                                var icons14 = new H.map.Icon('{{ asset('bundles/ffbb/images/icon14.png') }}');
                                var icons15 = new H.map.Icon('{{ asset('bundles/ffbb/images/icon15.png') }}');
                                var icons16 = new H.map.Icon('{{ asset('bundles/ffbb/images/icon16.png') }}');
                                var icons17 = new H.map.Icon('{{ asset('bundles/ffbb/images/icon17.png') }}');
                                var icons18 = new H.map.Icon('{{ asset('bundles/ffbb/images/icon18.png') }}');
                                var icons19 = new H.map.Icon('{{ asset('bundles/ffbb/images/icon19.png') }}');
                                var icons20 = new H.map.Icon('{{ asset('bundles/ffbb/images/icon20.png') }}');
                                var icons21 = new H.map.Icon('{{ asset('bundles/ffbb/images/icon21.png') }}');
                                var icons22 = new H.map.Icon('{{ asset('bundles/ffbb/images/icon22.png') }}');
                                var icons23 = new H.map.Icon('{{ asset('bundles/ffbb/images/icon23.png') }}');
                                var icons24 = new H.map.Icon('{{ asset('bundles/ffbb/images/icon24.png') }}');
                                var icons25 = new H.map.Icon('{{ asset('bundles/ffbb/images/icon25.png') }}');
                                //construction des points de differentes villes
                                function addMarkersAndSetViewBounds() {
                                    var incrment = 1;
                                    var points = [];
                                    var incrementIcons = 0;
                                    {%  for poule,  coordPouleOpSansContrainte in coordPoulesOpSansContrainte %}

                                    //tracer dynamiquement les points de villes
                                    {% for coordonneeVilleOpSansContrainte in coordPouleOpSansContrainte %}
                                    var x = '{{ coordonneeVilleOpSansContrainte[0]}}';
                                    var y = '{{ coordonneeVilleOpSansContrainte[1]}}';
//
                                    var xy = x+y;

//                                                                 var icon = 'icons' + incrementIcons;
                                    var icon = 'icons{{ poule-1 }}' ;
                                    var marker = 'marker' + incrment;
                                    window[marker] = new H.map.Marker({
                                        lat: parseFloat(x),
                                        lng: parseFloat(y)
                                    }, {icon: window[icon]} );


                                    points.push(window[marker]);

                                    var incrment = incrment + 1;

                                    {% endfor %}
                                    incrementIcons++;
                                    {% endfor %}
                                    group = new H.map.Group();
                                    // add markers to the group
                                    group.addObjects(points);
                                    map.addObject(group);
                                    // get geo bounding box for the group and set it to the map
                                    map.setViewBounds(group.getBounds());
                                }



                                /**
                                 * Boilerplate map initialization code starts below:
                                 */

                                //Step 1: initialize communication with the platform
                                var platform = new H.service.Platform({
                                    app_id: '{{ app_id }}',
                                    app_code: '{{ app_code }}',
                                    useCIT: true,
                                    useHTTPS: true
                                });
                                var defaultLayers = platform.createDefaultLayers();

                                //Step 2: initialize a map - this map is centered over Europe
                                var map = new H.Map(document.getElementById('mapOpSansContrainte'),
                                        defaultLayers.normal.map, {
                                            center: {lat: 48.8567, lng: 2.3508},
                                            zoom: 3
                                        });

                                var behavior = new H.mapevents.Behavior(new H.mapevents.MapEvents(map));
                                // Create the default UI components
                                //    var ui = H.ui.UI.createDefault(map, defaultLayers);
                                var ui = H.ui.UI.createDefault(map, defaultLayers, 'fr-FR');

                                // Now use the map as required...
                                // Add the marker to the map:
                                // map.addObject(markerPrincipal);
                                addMarkersAndSetViewBounds(map);
                                switchMapLanguage(map, platform);

                            </script>

                            <!-- Nav tabs -->
                            <ul class="nav nav-tabs">
                                <li class="active"><a href="#EstimationsOpSansContrainte" data-toggle="tab">Estimations</a>
                                </li>
                                <li><a href="#DetailsOpSansContrainte" data-toggle="tab">Détails</a>
                                </li>
                                <li><a href="#listeRencontresOptSansContrainte" data-toggle="tab">Liste des rencontres</a></li>

                            </ul>

                            <!-- Tab panes -->
                            <div class="tab-content">
                                <div class="tab-pane fade in active" id="EstimationsOpSansContrainte">

                                    <div class="list-group">

                                        <p class="list-group-item">
                                            <i class="fa fa-road fa-fw"
                                               style="padding-right: 30px"></i> <strong>{{ distanceMinOpSansContrainte|number_format(0, ',', ' ') }} </strong>
                                            Kms au total
                                            à parcourir pour l'ensemble du scénario
                                        </p>
                                        <p class="list-group-item">
                                            <img src="{{ asset('bundles/ffbb/images/icons/money-icon.png') }}"
                                                 width="20px" height="20px"/>
                                            <i style="padding-right: 10px"></i> <strong> {{ (distanceTotaleOpSansContrainte * 0.80 )|round|number_format(0, ',', ' ') }}</strong>
                                            € pour réaliser les trajets de l'ensemble du scénario
                                            en voiture

                                        </p>
                                        <p class="list-group-item">
                                            <img src="{{ asset('bundles/ffbb/images/icons/money-icon.png') }}"
                                                 width="20px" height="20px"/>
                                            <i style="padding-right: 10px"></i> <strong> {{ (distanceTotaleOpSansContrainte /4 * 0.80 )|round|number_format(0, ',', ' ') }}</strong>
                                            € pour réaliser les trajets de l'ensemble du scénario
                                            en covoiturage

                                        </p>
                                        <p class="list-group-item">
                                            <img src="{{ asset('bundles/ffbb/images/icons/money-icon.png') }}"
                                                 width="20px" height="20px"/>
                                            <i style="padding-right: 10px"></i>
                                            <strong>{{ (distanceTotaleOpSansContrainte /9 * 1.31)|round|number_format(0, ',', ' ') }} </strong>
                                            € pour réaliser les trajets de l'ensemble du scénario
                                            en minibus

                                        </p>

                                        <p class="list-group-item">
                                            <img src="{{ asset('bundles/ffbb/images/icons/car-icon.png') }}"
                                                 width="20px" height="20px"/>
                                            <i style="padding-right: 10px"></i> <strong> {{ (distanceTotaleOpSansContrainte * 0.157)|round|number_format(0, ',', ' ') }}</strong>
                                            KG eq CO2 d'émissions totales de GES pour {{ nbrParticipantsTotalOpSansContrainte }}
                                            joueurs en voiture individuelle
                                            pour le scénario

                                        </p>
                                        <p class="list-group-item">
                                            <img src="{{ asset('bundles/ffbb/images/icons/covoiturage-icon.png') }}"
                                                 width="20px" height="20px"/>
                                            <i style="padding-right: 10px"></i> <strong>{{ (distanceTotaleOpSansContrainte/4 * 0.157)|round|number_format(0, ',', ' ') }} </strong>
                                            KG eq CO2 d'émissions totales de GES pour {{ nbrParticipantsTotalOpSansContrainte }}
                                            joueurs en co-voiturage pour le scénario

                                        </p>

                                        <p class="list-group-item">
                                            <img src="{{ asset('bundles/ffbb/images/icons/bus-icon.png') }}"
                                                 width="20px" height="15px"/>
                                            <i style="padding-right: 10px"></i>
                                            <strong>{{ (distanceTotaleOpSansContrainte/9 * 0.185)|round|number_format(0, ',', ' ') }} </strong>
                                            KG eq CO2 d'émissions totales de GES pour {{ nbrParticipantsTotalOpSansContrainte }}
                                            joueurs en minibus pour le scénario

                                        </p>

                                    </div>


                                </div>
                                <div class="tab-pane fade" id="DetailsOpSansContrainte">
                                    <div class="table-responsive" style="padding-top: 10px">

                                        <table id="exampleRencontreEq" class="display"
                                               cellspacing="0"
                                               width="100%">
                                            <thead>
                                            <tr>
                                                <th style="font-weight: bold !important;">
                                                    Participants
                                                </th>
                                                <th>Kms à
                                                    parcourir
                                                </th>
                                                <th>Temps de parcours
                                                    (J H:M)
                                                </th>
                                                <th>Coût du parcours en
                                                    voiture(€)
                                                </th>
                                                <th>Coût du parcours en
                                                    covoiturage(€)
                                                </th>
                                                <th>Coût du parcours en
                                                    minibus(€)
                                                </th>
                                                <th>Emissions GES voiture
                                                    individuelle (en KG eq CO2)
                                                </th>
                                                <th>Emissions GES
                                                    covoiturage (en KG eq CO2)
                                                </th>

                                                <th>Emissions GES minibus
                                                    (en KG eq CO2)
                                                </th>
                                            </tr>
                                            </thead>
                                            <tbody>

                                            {% set dureeTotaleScOptSansContrainte = "" %}
                                            {% for key, estimationDetailOpSansContrainte in estimationDetailsOpSansContrainte %}
                                                {% set distanceOpSansContrainteDetail = estimationDetailsOpSansContrainte[ key ].distanceTotale // 1000 %}
                                                {% set distanceTotaleOpSansContrainteDetail = estimationDetailsOpSansContrainte[ key ].distanceTotaleTousParticipants // 1000 %}
                                                {% set dureeTotaleOpSansContrainteDetailC = estimationDetailsOpSansContrainte[ key ].dureeTotale  %}
                                                {% set nbrParticipantsOpSansContrainteDetail = estimationDetailsOpSansContrainte[ key ].nbrParticipantsTotal  %}
                                                {% set lettre = alphabet[key-1] %}
                                                <tr>
                                                    <td><strong> Poule {{ lettre }} </strong></td>
                                                    <td style="text-align:right"> {{distanceOpSansContrainteDetail|number_format(0, ',', ' ') }}</td>
                                                    <td style="text-align:center">

                                                        {# récupérer le nbr de jour #}
                                                        {% set nbrJourOpSansContrainteDetailC = (dureeTotaleOpSansContrainteDetailC/86400)|round %}
                                                        {% if nbrJourOpSansContrainteDetailC <10 %}
                                                            {% set nbrJourOpSansContrainteDetailC = "0"~nbrJourOpSansContrainteDetailC %}
                                                        {% endif %}
                                                        {# récupérer le nbr d heure #}
                                                        {% set nbrHeureOpSansContrainteDetailC = ((dureeTotaleOpSansContrainteDetailC%86400)/3600)|round %}
                                                        {% if nbrHeureOpSansContrainteDetailC <10 %}
                                                            {% set nbrHeureOpSansContrainteDetailC = "0"~nbrHeureOpSansContrainteDetailC %}
                                                        {% endif %}
                                                        {# récupérer le nbr de minute #}
                                                        {% set nbrMinOpSansContrainteDetailC = (((dureeTotaleOpSansContrainteDetailC%86400)%3600)/60)|round %}
                                                        {% if nbrMinOpSansContrainteDetailC <10 %}
                                                            {% set nbrMinOpSansContrainteDetailC = "0"~nbrMinOpSansContrainteDetailC %}
                                                        {% endif %}
                                                        {{ nbrJourOpSansContrainteDetailC}} {{ nbrHeureOpSansContrainteDetailC }}:{{ nbrMinOpSansContrainteDetailC }}

                                                    </td>
                                                    <td style="text-align:right"> {{ (distanceTotaleOpSansContrainteDetail  * 0.80)|round|number_format(0, ',', ' ') }}</td>
                                                    <td style="text-align:right"> {{ (distanceTotaleOpSansContrainteDetail /4 * 0.80)|round|number_format(0, ',', ' ') }}</td>
                                                    <td style="text-align:right"> {{ (distanceTotaleOpSansContrainteDetail /9 * 1.31)|round|number_format(0, ',', ' ') }}</td>
                                                    <td style="text-align:right"> {{ (distanceTotaleOpSansContrainteDetail * 0.157)|round|number_format(0, ',', ' ') }}</td>
                                                    <td style="text-align:right"> {{ ((distanceTotaleOpSansContrainteDetail /4)*0.157)|round|number_format(0, ',', ' ')  }} </td>
                                                    <td style="text-align:right"> {{ ((distanceTotaleOpSansContrainteDetail /9)*0.185)|round|number_format(0, ',', ' ') }} </td>
                                                </tr>
                                                {% set dureeTotaleScOptSansContrainte = dureeTotaleScOptSansContrainte + dureeTotaleOpSansContrainteDetailC %}

                                            {% endfor %}
                                            <tr>
                                                <td><strong> Totaux </strong></td>
                                                <td style="text-align:right"> {{distanceMinOpSansContrainte|number_format(0, ',', ' ') }}</td>
                                                <td style="text-align:center">
                                                    {# récupérer le nbr de jour #}
                                                    {% set nbrJourScOptSansContrainte = (dureeTotaleScOptSansContrainte/86400)|round %}
                                                    {% if nbrJourScOptSansContrainte <10 %}
                                                        {% set nbrJourScOptSansContrainte = "0"~nbrJourScOptSansContrainte %}
                                                    {% endif %}
                                                    {# récupérer le nbr d heure #}
                                                    {% set nbrHeureScOptSansContrainte = ((dureeTotaleScOptSansContrainte%86400)/3600)|round %}
                                                    {% if nbrHeureScOptSansContrainte <10 %}
                                                        {% set nbrHeureScOptSansContrainte = "0"~nbrHeureScOptSansContrainte %}
                                                    {% endif %}
                                                    {# récupérer le nbr de minute #}
                                                    {% set nbrMinScOptSansContrainte = (((dureeTotaleScOptSansContrainte%86400)%3600)/60)|round %}
                                                    {% if nbrMinScOptSansContrainte <10 %}
                                                        {% set nbrMinScOptSansContrainte = "0"~nbrMinScOptSansContrainte %}
                                                    {% endif %}
                                                    {{ nbrJourScOptSansContrainte}} {{ nbrHeureScOptSansContrainte }}:{{ nbrMinScOptSansContrainte }}
                                                </td>
                                                <td style="text-align:right"> {{ (distanceTotaleOpSansContrainte  * 0.80)|round|number_format(0, ',', ' ') }}</td>
                                                <td style="text-align:right"> {{ (distanceTotaleOpSansContrainte /4 * 0.80)|round|number_format(0, ',', ' ') }}</td>
                                                <td style="text-align:right"> {{ (distanceTotaleOpSansContrainte /9 * 1.31)|round|number_format(0, ',', ' ') }}</td>
                                                <td style="text-align:right"> {{ (distanceTotaleOpSansContrainte * 0.157)|round|number_format(0, ',', ' ') }}</td>
                                                <td style="text-align:right"> {{ ((distanceTotaleOpSansContrainte /4)*0.157)|round|number_format(0, ',', ' ')  }} </td>
                                                <td style="text-align:right"> {{ ((distanceTotaleOpSansContrainte/9)*0.185)|round|number_format(0, ',', ' ') }} </td>
                                            </tr>
                                            </tbody>
                                        </table>

                                    </div>
                                    <!-- /.table-responsive -->
                                </div>
                                <div class="tab-pane fade" id="listeRencontresOptSansContrainte">
                                    <div class="table-responsive" style="padding-top: 10px; max-height: 400px; overflow-y: scroll;">

                                        <table id="scOpSansContrainte" class="display"
                                               cellspacing="0"
                                               width="100%">
                                            {% if typeMatch == "allerRetour" or typeMatch == "allerSimple" %}
                                                <thead>
                                                <tr>
                                                    <th style="font-weight: bold !important;">
                                                        Poules
                                                    </th>
                                                    <th>Rencontres</th>

                                                </tr>
                                                </thead>
                                                <tbody>

                                                {% for keyOptSansContrainte, rencontreDetailOpSansContrainte in rencontreDetailsOpSansContrainte %}
                                                    {% set distanceOptSansContrainte = rencontreDetailsOpSansContrainte[ keyOptSansContrainte ] %}
                                                    {% set lettre = alphabet[keyOptSansContrainte-1] %}
                                                    <tr>
                                                        <td><strong> Poule {{ lettre }} </strong></td>
                                                        <td>
                                                            <ul>
                                                                {% for keyDetailOptSansContrainte, detailsOptSansContrainte in distanceOptSansContrainte %}
                                                                    <li>
                                                                        {{ distanceOptSansContrainte[ loop.index ].equipeDepartNom }} ~ {{ distanceOptSansContrainte[ loop.index ].equipeDestinationNom }}
                                                                    </li>

                                                                {% endfor %}
                                                            </ul>
                                                        </td>

                                                    </tr>

                                                {% endfor %}

                                                </tbody>
                                            {% elseif typeMatch == 'plateau' %}

                                                <thead>
                                                <tr>
                                                    <th style="font-weight: bold !important;">Poules</th>
                                                    <th>Journée</th>
                                                    <th>Equipe hôte</th>
                                                    <th>Equipes adverses</th>

                                                </tr>
                                                </thead>
                                                <tbody>

                                                {% for poule, contenuPoule in rencontreDetailsOpSansContrainte %}
                                                    {% set lettre = alphabet[poule-1] %}
                                                    {% for journee, contenuJournee in contenuPoule %}
                                                        <tr>
                                                            <td ><strong> Poule {{ lettre }}  </strong></td>
                                                            <td>
                                                                {{ journee }}
                                                            </td>
                                                            <td>
                                                                {% for contenuGroup in contenuJournee %}
                                                                    {{ contenuGroup.hoteNom }} <br/> <br/>
                                                                {% endfor %}
                                                            </td>
                                                            <td>
                                                                {% for contenuGroup in contenuJournee %}
                                                                    * {{ contenuGroup.premierEquipeNom }} <br/>
                                                                    * {{ contenuGroup.deuxiemeEquipeNom }} <br/>
                                                                {% endfor %}
                                                            </td>

                                                        </tr>

                                                    {% endfor %}


                                                {% endfor %}
                                                </tbody>



                                            {% endif %}


                                        </table>

                                    </div>
                                    <!-- /.table-responsive -->
                                </div>
                                <a href="{{ path('ffbb_poules_details_calcul') }}" class="pull-left">Détails
                                    du calcul</a>

                                {#<form name="submitParams" action="{{ path('ffbb_poules_previsualisation_export')}}" method="post">#}
                                <form name="submitParams" action="{{ path('ffbb_poules_pretraitement_export')}}" method="post">
                                    <input type="hidden" value="{{ idResultat }}" name="idResultat">
                                    <input type="hidden" value="optimalSansContrainte" name="typeScenario" >

                                    <select onchange="this.form.submit()"  class="btn btn-primary pull-right" name="formatExport" >
                                        <option value="" disabled="disabled" selected="selected">Choisir un format d'export</option>
                                        <option value="pdf">Exporter en PDF</option>
                                        <option value="xml">Exporter en XML</option>
                                        <option value="csv">Exporter en CSV</option>
                                    </select>

                                </form>


                                {#<form name="submitParams" action="{{ path('ffbb_previsualisation_pdf')}}" method="post">#}
                                    {#<input type="hidden" value="{{ idResultat }}" name="idResultat" >#}
                                    {#<input type="hidden" value="optimalSansContrainte" name="typeScenario" >#}

                                    {#<button type="submit" class="btn btn-primary  pull-right">Exporter</button>#}
                                {#</form>#}




                            </div>
                        </div>
                    </div>


                </div>
            </div>
            <!-- .panel-body -->
            <!-- /.panel -->
        </div>
        <!-- /.col-lg-6 -->


        <!-- Scénario de référence -->
        {% if refExiste == 1 %}
            <div class="col-lg-6">

                <!-- declaration de variables -->
                <!-- distanceMin -->
                {% set distanceMinRef = scenarioRef.estimationGenerale.distanceTotale %}
                {% set distanceMinRef = (distanceMinRef / 1000)|round %}
                <!-- distanceTotale -->
                {% set distanceTotaleRef = scenarioRef.estimationGenerale.distanceTotaleTousParticipants %}
                {% set distanceTotaleRef = (distanceTotaleRef / 1000)|round %}
                <!-- nbrParticipantsTotal -->
                {% set nbrParticipantsTotalRef = scenarioRef.estimationGenerale.nbrParticipantsTotal %}
                <!-- dureeTotale -->
                {% set dureeTotaleRef = scenarioRef.estimationGenerale.dureeTotale %}
                <!-- estimationDetails -->
                {% set estimationDetailsRef = scenarioRef.estimationDetails %}
                <!-- rencontreDetails -->
                {% set rencontreDetailsRef = scenarioRef.rencontreDetails %}
                <!-- coordPoules -->
                {% set coordPoulesRef = scenarioRef.poulesCoords %}
                <div class="panel-body">
                    <div class="panel-group" id="scOptimalSansContrainte">
                        <div class="panel panel-default">
                            <div class="panel-heading">
                                <h4 class="panel-title">
                                    Scénario de référence
                                </h4>
                            </div>
                            <div class="panel-body"> <!-- premier scÃ©nario -->
                                <div id="mapRef"
                                     style="width: 100%; height: 500px; background: grey"></div>
                                <script type="text/javascript" charset="UTF-8">

                                    /**
                                     *
                                     * Changer la langue de la carte
                                     */
                                    function switchMapLanguage(map, platform) {
                                        var mapTileService = platform.getMapTileService({
                                                    type: 'base'
                                                }),
                                                frenchMapLayer = mapTileService.createTileLayer(
                                                        'maptile',
                                                        'normal.day',
                                                        256,
                                                        'png8',
                                                        {lg: 'fre'}
                                                );
                                        map.setBaseLayer(frenchMapLayer);


                                    }
                                    /*
                                     Fin fn changer langue
                                     */

                                    // Create a marker icon from an image URL:

                                    var icons0 = new H.map.Icon('{{ asset('bundles/ffbb/images/icon0.png') }}');
                                    var icons1 = new H.map.Icon('{{ asset('bundles/ffbb/images/icon1.png') }}');
                                    var icons2 = new H.map.Icon('{{ asset('bundles/ffbb/images/icon2.png') }}');
                                    var icons3 = new H.map.Icon('{{ asset('bundles/ffbb/images/icon3.png') }}');
                                    var icons4 = new H.map.Icon('{{ asset('bundles/ffbb/images/icon4.png') }}');
                                    var icons5 = new H.map.Icon('{{ asset('bundles/ffbb/images/icon5.png') }}');
                                    var icons6 = new H.map.Icon('{{ asset('bundles/ffbb/images/icon6.png') }}');
                                    var icons7 = new H.map.Icon('{{ asset('bundles/ffbb/images/icon7.png') }}');
                                    var icons8 = new H.map.Icon('{{ asset('bundles/ffbb/images/icon8.png') }}');
                                    var icons9 = new H.map.Icon('{{ asset('bundles/ffbb/images/icon9.png') }}');
                                    var icons10 = new H.map.Icon('{{ asset('bundles/ffbb/images/icon10.png') }}');
                                    var icons11 = new H.map.Icon('{{ asset('bundles/ffbb/images/icon11.png') }}');
                                    var icons12 = new H.map.Icon('{{ asset('bundles/ffbb/images/icon12.png') }}');
                                    var icons13 = new H.map.Icon('{{ asset('bundles/ffbb/images/icon13.png') }}');
                                    var icons14 = new H.map.Icon('{{ asset('bundles/ffbb/images/icon14.png') }}');
                                    var icons15 = new H.map.Icon('{{ asset('bundles/ffbb/images/icon15.png') }}');
                                    var icons16 = new H.map.Icon('{{ asset('bundles/ffbb/images/icon16.png') }}');
                                    var icons17 = new H.map.Icon('{{ asset('bundles/ffbb/images/icon17.png') }}');
                                    var icons18 = new H.map.Icon('{{ asset('bundles/ffbb/images/icon18.png') }}');
                                    var icons19 = new H.map.Icon('{{ asset('bundles/ffbb/images/icon19.png') }}');
                                    var icons20 = new H.map.Icon('{{ asset('bundles/ffbb/images/icon20.png') }}');
                                    var icons21 = new H.map.Icon('{{ asset('bundles/ffbb/images/icon21.png') }}');
                                    var icons22 = new H.map.Icon('{{ asset('bundles/ffbb/images/icon22.png') }}');
                                    var icons23 = new H.map.Icon('{{ asset('bundles/ffbb/images/icon23.png') }}');
                                    var icons24 = new H.map.Icon('{{ asset('bundles/ffbb/images/icon24.png') }}');
                                    var icons25 = new H.map.Icon('{{ asset('bundles/ffbb/images/icon25.png') }}');
                                    //construction des points de differentes villes
                                    function addMarkersAndSetViewBounds() {
                                        var incrment = 1;
                                        var points = [];
                                        var incrementIcons = 0;
                                        {%  for poule, coordPouleRef in coordPoulesRef %}

                                        //tracer dynamiquement les points de villes
                                        {% for coordonneeVilleRef in coordPouleRef %}
                                        var x = '{{ coordonneeVilleRef[0]}}';
                                        var y = '{{ coordonneeVilleRef[1]}}';
//
                                        var xy = x+y;

//                                                                 var icon = 'icons' + incrementIcons;
                                        var icon = 'icons{{ poule-1 }}' ;
                                        var marker = 'marker' + incrment;
                                        window[marker] = new H.map.Marker({
                                            lat: parseFloat(x),
                                            lng: parseFloat(y)
                                        }, {icon: window[icon]}  );


                                        points.push(window[marker]);

                                        var incrment = incrment + 1;

                                        {% endfor %}
                                        incrementIcons++;
                                        {% endfor %}
                                        group = new H.map.Group();
                                        // add markers to the group
                                        group.addObjects(points);
                                        map.addObject(group);
                                        // get geo bounding box for the group and set it to the map
                                        map.setViewBounds(group.getBounds());
                                    }



                                    /**
                                     * Boilerplate map initialization code starts below:
                                     */

                                    //Step 1: initialize communication with the platform
                                    var platform = new H.service.Platform({
                                        app_id: '{{ app_id }}',
                                        app_code: '{{ app_code }}',
                                        useCIT: true,
                                        useHTTPS: true
                                    });
                                    var defaultLayers = platform.createDefaultLayers();

                                    //Step 2: initialize a map - this map is centered over Europe
                                    var map = new H.Map(document.getElementById('mapRef'),
                                            defaultLayers.normal.map, {
                                                center: {lat: 48.8567, lng: 2.3508},
                                                zoom: 3
                                            });

                                    var behavior = new H.mapevents.Behavior(new H.mapevents.MapEvents(map));
                                    // Create the default UI components
                                    //    var ui = H.ui.UI.createDefault(map, defaultLayers);
                                    var ui = H.ui.UI.createDefault(map, defaultLayers, 'fr-FR');

                                    // Now use the map as required...
                                    // Add the marker to the map:
                                    // map.addObject(markerPrincipal);
                                    addMarkersAndSetViewBounds(map);
                                    switchMapLanguage(map, platform);

                                </script>

                                <!-- Nav tabs -->
                                <ul class="nav nav-tabs">
                                    <li class="active"><a href="#EstimationsRef" data-toggle="tab">Estimations</a>
                                    </li>
                                    <li><a href="#DetailsRef" data-toggle="tab">Détails</a>
                                    </li>

                                    {% if typeMatch == "plateau" %}
                                        <li><a href="#listeRencontresRef" data-toggle="tab">Liste des rencontres</a>
                                        </li>
                                    {% endif %}

                                </ul>

                                <!-- Tab panes -->
                                <div class="tab-content">
                                    <div class="tab-pane fade in active" id="EstimationsRef">

                                        <div class="list-group">

                                            <p class="list-group-item">
                                                <i class="fa fa-road fa-fw"
                                                   style="padding-right: 30px"></i> <strong>{{ distanceMinRef|number_format(0, ',', ' ') }} </strong>
                                                Kms au total
                                                à parcourir pour l'ensemble du scénario
                                            </p>
                                            <p href="#" class="list-group-item">
                                                <img src="{{ asset('bundles/ffbb/images/icons/money-icon.png') }}"
                                                     width="20px" height="20px"/>
                                                <i style="padding-right: 10px"></i> <strong>{{ (distanceTotaleRef * 0.80 )|round|number_format(0, ',', ' ') }}</strong>
                                                € pour réaliser les trajets de l'ensemble du scénario
                                                en voiture

                                            </p>
                                            <p href="#" class="list-group-item">
                                                <img src="{{ asset('bundles/ffbb/images/icons/money-icon.png') }}"
                                                     width="20px" height="20px"/>
                                                <i style="padding-right: 10px"></i> <strong>{{ (distanceTotaleRef /4 * 0.80 )|round|number_format(0, ',', ' ') }} </strong>
                                                € pour réaliser les trajets de l'ensemble du scénario
                                                covoiturage

                                            </p>

                                            <p class="list-group-item">
                                                <img src="{{ asset('bundles/ffbb/images/icons/money-icon.png') }}"
                                                     width="20px" height="20px"/>
                                                <i style="padding-right: 10px"></i>
                                                <strong> {{ (distanceTotaleRef /9 * 1.31)|round|number_format(0, ',', ' ') }}</strong>
                                                € pour réaliser les trajets de l'ensemble du scénario
                                                en minibus

                                            </p>
                                            <p class="list-group-item">
                                                <img src="{{ asset('bundles/ffbb/images/icons/car-icon.png') }}"
                                                     width="20px" height="20px"/>
                                                <i style="padding-right: 10px"></i> <strong>{{ (distanceTotaleRef * 0.157)|round|number_format(0, ',', ' ') }} </strong>
                                                KG eq CO2 d'émissions totales de GES pour {{ nbrParticipantsTotalRef }}
                                                joueurs en voiture individuelle
                                                pour le scénario

                                            </p>
                                            <p class="list-group-item">
                                                <img src="{{ asset('bundles/ffbb/images/icons/covoiturage-icon.png') }}"
                                                     width="20px" height="20px"/>
                                                <i style="padding-right: 10px"></i> <strong>{{ (distanceTotaleRef/4 * 0.157)|round|number_format(0, ',', ' ') }} </strong>
                                                KG eq CO2 d'émissions totales de GES pour {{ nbrParticipantsTotalRef }}
                                                joueurs en co-voiturage pour le scénario

                                            </p>

                                            <p class="list-group-item">
                                                <img src="{{ asset('bundles/ffbb/images/icons/bus-icon.png') }}"
                                                     width="20px" height="15px"/>
                                                <i style="padding-right: 10px"></i>
                                                <strong>{{ (distanceTotaleRef/9 * 0.185)|round|number_format(0, ',', ' ') }} </strong>
                                                KG eq CO2 d'émissions totales de GES pour {{ nbrParticipantsTotalRef }}
                                                joueurs en minibus pour le scénario

                                            </p>

                                        </div>
                                    </div>

                                    <div class="tab-pane fade" id="DetailsRef">
                                        <div class="table-responsive" style="padding-top: 10px">

                                            <table id="scReference" class="display"
                                                   cellspacing="0"
                                                   width="100%">
                                                <thead>
                                                <tr>
                                                    <th style="font-weight: bold !important;">
                                                        Participants
                                                    </th>
                                                    <th>Kms à
                                                        parcourir
                                                    </th>
                                                    <th>Temps de parcours
                                                        (J H:M)
                                                    </th>
                                                    <th>Coût du parcours en
                                                        voiture(€)
                                                    </th>
                                                    <th>Coût du parcours en
                                                        covoiturage(€)
                                                    </th>
                                                    <th>Coût du parcours en
                                                        minibus(€)
                                                    </th>
                                                    <th>Emissions GES voiture
                                                        individuelle (en KG eq CO2)
                                                    </th>
                                                    <th>Emissions GES
                                                        covoiturage (en KG eq CO2)
                                                    </th>

                                                    <th>Emissions GES minibus
                                                        (en KG eq CO2)
                                                    </th>
                                                </tr>
                                                </thead>
                                                <tbody>

                                                {% set dureeTotaleScRefContrainte = "" %}
                                                {% for key, estimationDetailRef in estimationDetailsRef %}
                                                    {% set distanceRefDetail = estimationDetailsRef[ key ].distanceTotale // 1000 %}
                                                    {% set distanceTotaleRefDetail = estimationDetailsRef[ key ].distanceTotaleTousParticipants // 1000 %}
                                                    {% set dureeTotaleRefDetail = estimationDetailsRef[ key ].dureeTotale  %}
                                                    {% set nbrParticipantsRefDetail = estimationDetailsRef[ key ].nbrParticipantsTotal  %}
                                                    {% set lettre = alphabet[key-1] %}

                                                    <tr>
                                                        <td><strong> Poule {{ lettre }} </strong></td>
                                                        <td style="text-align:right"> {{distanceRefDetail|number_format(0, ',', ' ') }}</td>
                                                        <td style="text-align:center">

                                                            {# récupérer le nbr de jour #}
                                                            {% set nbrJourRefDetailContrainte = (dureeTotaleRefDetail/86400)|round %}
                                                            {% if nbrJourRefDetailContrainte <10 %}
                                                                {% set nbrJourRefDetailContrainte = "0"~nbrJourRefDetailContrainte %}
                                                            {% endif %}
                                                            {# récupérer le nbr d heure #}
                                                            {% set nbrHeureRefDetailContrainte = ((dureeTotaleRefDetail%86400)/3600)|round %}
                                                            {% if nbrHeureRefDetailContrainte <10 %}
                                                                {% set nbrHeureRefDetailContrainte = "0"~nbrHeureRefDetailContrainte %}
                                                            {% endif %}
                                                            {# récupérer le nbr de minute #}
                                                            {% set nbrMinRefDetailContrainte = (((dureeTotaleRefDetail%86400)%3600)/60)|round %}
                                                            {% if nbrMinRefDetailContrainte <10 %}
                                                                {% set nbrMinRefDetailContrainte = "0"~nbrMinRefDetailContrainte %}
                                                            {% endif %}
                                                            {{ nbrJourRefDetailContrainte}} {{ nbrHeureRefDetailContrainte }}:{{ nbrMinRefDetailContrainte }}

                                                        </td>
                                                        <td style="text-align:right"> {{ (distanceTotaleRefDetail  * 0.80)|round|number_format(0, ',', ' ') }}</td>
                                                        <td style="text-align:right"> {{ (distanceTotaleRefDetail /4 * 0.80)|round|number_format(0, ',', ' ') }}</td>
                                                        <td style="text-align:right"> {{ (distanceTotaleRefDetail /9 * 1.31)|round|number_format(0, ',', ' ') }}</td>
                                                        <td style="text-align:right"> {{ (distanceTotaleRefDetail * 0.157)|round|number_format(0, ',', ' ') }}</td>
                                                        <td style="text-align:right"> {{ ((distanceTotaleRefDetail /4)*0.157)|round|number_format(0, ',', ' ')  }} </td>
                                                        <td style="text-align:right"> {{ ((distanceTotaleRefDetail /9)*0.185)|round|number_format(0, ',', ' ') }} </td>
                                                    </tr>
                                                    {% set dureeTotaleScRefContrainte = dureeTotaleScRefContrainte + dureeTotaleRefDetail %}
                                                {% endfor %}
                                                <tr>
                                                    <td><strong> Totaux </strong></td>
                                                    <td style="text-align:right"> {{ distanceMinRef|number_format(0, ',', ' ') }}</td>
                                                    <td style="text-align:center">

                                                        {# récupérer le nbr de jour #}
                                                        {% set nbrJourScRefContrainte = (dureeTotaleScRefContrainte/86400)|round %}
                                                        {% if nbrJourScRefContrainte <10 %}
                                                            {% set nbrJourScRefContrainte = "0"~nbrJourScRefContrainte %}
                                                        {% endif %}
                                                        {# récupérer le nbr d heure #}
                                                        {% set nbrHeureScRefContrainte = ((dureeTotaleScRefContrainte%86400)/3600)|round %}
                                                        {% if nbrHeureScRefContrainte <10 %}
                                                            {% set nbrHeureScRefContrainte = "0"~nbrHeureScRefContrainte %}
                                                        {% endif %}
                                                        {# récupérer le nbr de minute #}
                                                        {% set nbrMinScRefContrainte = (((dureeTotaleScRefContrainte%86400)%3600)/60)|round %}
                                                        {% if nbrMinScRefContrainte <10 %}
                                                            {% set nbrMinScRefContrainte = "0"~nbrMinScRefContrainte %}
                                                        {% endif %}
                                                        {{ nbrJourScRefContrainte}} {{ nbrHeureScRefContrainte }}:{{ nbrMinScRefContrainte }}

                                                    </td>
                                                    <td style="text-align:right"> {{ (distanceTotaleRef  * 0.80)|round|number_format(0, ',', ' ') }}</td>
                                                    <td style="text-align:right"> {{ (distanceTotaleRef /4 * 0.80)|round|number_format(0, ',', ' ') }}</td>
                                                    <td style="text-align:right"> {{ (distanceTotaleRef /9 * 1.31)|round|number_format(0, ',', ' ') }}</td>
                                                    <td style="text-align:right"> {{ (distanceTotaleRef * 0.157)|round|number_format(0, ',', ' ') }}</td>
                                                    <td style="text-align:right"> {{ ((distanceTotaleRef /4)*0.157)|round|number_format(0, ',', ' ')  }} </td>
                                                    <td style="text-align:right"> {{ ((distanceTotaleRef /9)*0.185)|round|number_format(0, ',', ' ') }} </td>
                                                </tr>


                                                </tbody>
                                            </table>

                                        </div>
                                        <!-- /.table-responsive -->
                                    </div>


                                    {% if typeMatch == "plateau" %}
                                        <div class="tab-pane fade" id="listeRencontresRef">
                                            <div class="table-responsive" style="padding-top: 10px; max-height: 400px; overflow-y: scroll;">

                                                {#<table id="exampleTerrain" class="display"#}
                                                <table id="exampleTerrain" class="cell-border"
                                                       cellspacing="0"
                                                       width="100%">

                                                    <thead>
                                                    <tr>
                                                        <th style="font-weight: bold !important;">
                                                            Poules
                                                        </th>
                                                        <th>Journée</th>
                                                        <th>Equipe hôte</th>
                                                        <th>Equipes adverses</th>

                                                    </tr>
                                                    </thead>
                                                    <tbody>

                                                    {% for poule, contenuPoule in rencontreDetailsRef %}
                                                        {% set lettre = alphabet[poule-1] %}
                                                        {% for journee, contenuJournee in contenuPoule %}
                                                            <tr>
                                                                <td ><strong> Poule {{ lettre }}  </strong></td>
                                                                <td>
                                                                    {{ journee }}
                                                                </td>
                                                                <td>
                                                                    {% for contenuGroup in contenuJournee %}
                                                                        {{ contenuGroup.hoteNom }} <br/> <br/>
                                                                    {% endfor %}
                                                                </td>
                                                                <td>
                                                                    {% for contenuGroup in contenuJournee %}
                                                                        * {{ contenuGroup.premierEquipeNom }} <br/>
                                                                        * {{ contenuGroup.deuxiemeEquipeNom }} <br/>
                                                                    {% endfor %}
                                                                </td>



                                                            </tr>

                                                        {% endfor %}


                                                    {% endfor %}


                                                    </tbody>
                                                </table>

                                            </div>
                                            <!-- /.table-responsive -->
                                        </div>

                                    {% endif %}





                                    <a href="{{ path('ffbb_poules_details_calcul') }}" class="pull-left">Détails
                                        du calcul</a>


                                    {#<form name="submitParams" action="{{ path('ffbb_poules_previsualisation_export')}}" method="post">#}
                                    <form name="submitParams" action="{{ path('ffbb_poules_pretraitement_export')}}" method="post">
                                        <input type="hidden" value="{{ idResultat }}" name="idResultat">
                                        <input type="hidden" value="ref" name="typeScenario" >

                                        <select onchange="this.form.submit()"  class="btn btn-primary pull-right" name="formatExport" >
                                            <option value="" disabled="disabled" selected="selected">Choisir un format d'export</option>
                                            <option value="pdf">Exporter en PDF</option>
                                            <option value="xml">Exporter en XML</option>
                                            <option value="csv">Exporter en CSV</option>
                                        </select>

                                    </form>


                                    {#<form name="submitParams" action="{{ path('ffbb_previsualisation_pdf')}}" method="post">#}
                                        {#<input type="hidden" value="{{ idResultat }}" name="idResultat">#}
                                        {#<input type="hidden" value="ref" name="typeScenario" >#}

                                        {#<button type="submit" class="btn btn-primary  pull-right">Exporter</button>#}
                                    {#</form>#}


                                </div>
                            </div>
                        </div>


                    </div>
                </div>
                <!-- .panel-body -->
                <!-- /.panel -->
            </div>
            <!-- /.col-lg-6 -->
        {% endif %}

    </div>



</div>
<!-- .panel-body -->
